# DAAN × ANP 对接与取舍清单

> **更新日期**: 2026-02-04  
> **目标**: 明确 DAAN（AgentNetwork）与 ANP（Agent Network Protocol）的关系：**不重复造轮子**，把 DAAN 定位为“开放环境下可执行的约束层/信任层/传输层”，并尽可能复用 ANP 的身份、描述与发现标准。

---

## 1. 定位：互补而非替代

- **ANP 解决**：开放互联网上 Agent 的 **身份（DID）**、**描述（JSON-LD）**、**发现（.well-known）** 与基于 Web 的互操作。
- **DAAN 解决**：当对手是恶意节点时，Agent 网络如何长期运行：
  - P2P 传输与连通（libp2p / DHT / NAT / Relay）
  - 抗滥用与配额（RateLimit + 声誉门槛 + 行为分析）
  - 声誉传播与时间衰减（局部视图、口碑式传播）
  - 担保入网与连带责任（邀请限额、抵押/责任结算）
  - 轻量存证（事件账本，关键事件可验证、可回放）
  - 可观测性与仿真测试（webadmin + 多层测试体系）

一句话：**ANP 是“Agent 的 HTTP/语义层”，DAAN 是“让它在不可信环境里还能跑”的约束与执行层。**

---

## 2. 对接原则（取舍准则）

### 2.1 我们直接采用 ANP/现有 Web 标准的部分（避免重复造轮子）

1) **Agent 描述与发现**
- 采用 `.well-known/agent-descriptions` 作为面向互联网的发现入口。
- 采用 JSON-LD + schema.org 语义作为 Agent/服务描述主格式。

2) **身份表达（DID）**
- 对外暴露 DID 与 DID 文档（建议优先实现 `did:web` / `did:key`，再兼容 `did:wba`）。
- DID 文档的 serviceEndpoint 同时发布：
  - HTTP API / gRPC
  - DAAN P2P endpoint（multiaddr + peer id）

3) **接口表达**
- 结构化接口优先用 OpenAPI/JSON-RPC 等成熟格式；自然语言接口以“可检索的描述文件”呈现。

### 2.2 我们必须保留的 DAAN 独特约束层（差异化壁垒）

1) **抗滥用引擎（配额/限流 + 行为分析 + 黑名单）**
- 高声誉节点享有更高配额；低声誉节点受限或禁用关键操作。
- 对可疑行为/女巫群体给出事件与处置动作（blocked / warned / monitored）。

2) **担保入网（邀请 + 连带责任）**
- 新节点默认走“担保/邀请”通道入网；对担保者设置：
  - 最低声誉阈值
  - 日邀请上限
  - 违规冷却期
  - 连带责任结算

3) **轻量事件存证（Event Ledger）**
- 只存证关键事件（入网、违规、担保关系、委员会决策等），避免把所有声誉/任务状态都上升为全网共识。

4) **P2P 传输与邻居路由**
- 将“通信成本/路径约束”下沉到网络层，让恶意行为在成本上变贵。

---

## 3. 分层对接清单（推荐路线）

| 层级 | 直接采用/兼容（ANP/标准） | 保留/强化（DAAN） | 备注（落地方式） |
|---|---|---|---|
| 身份 | DID（did:web/did:key/后续 did:wba）+ DID 文档 | 节点本地密钥与入网治理 | 以 DID 文档发布 P2P/HTTP endpoints；内部继续用 peer id 与声誉体系 |
| 发现 | `.well-known/agent-descriptions` | DHT/邻居发现 | 互联网入口用 ANP；局域/P2P 用 DHT |
| 描述 | JSON-LD + schema.org + 接口描述（OpenAPI/JSON-RPC） | 能力/配额/信誉门槛作为扩展字段 | 描述里声明“需要担保/最低声誉/限流策略”等 |
| 传输 | HTTP（对外） | libp2p（对内） | 建议做一个“ANP 网关”：HTTP in → P2P task/message out |
| 安全 | 标准 Web TLS + DID 验签 | Nonce 防重放 + 行为检测 + 黑名单 | DAAN 的 anti-abuse 是“执行层”，不是文档层 |
| 声誉 | 可在描述里暴露查询接口 | 局部声誉 + 时间衰减 + 口碑传播 | 不追求全网一致，用“可解释的局部信任” |
| 入网治理 | 可公开加入流程描述 | 担保入网 + 连带责任 + 委员会事件存证 | 让女巫攻击变贵、让信誉有成本 |
| 存证 | 可导出可验证事件摘要 | 轻量事件账本 + 可回放 | 对外只暴露必要的可验证证据 |
| 可观测 | Web 标准 metrics/日志接口（可选） | webadmin 拓扑/限流状态/安全事件 | 用 demo 把“能观察到攻击并处置”展示出来 |

---

## 4. 3 个最能证明价值的 Demo 场景

### Demo 1：ANP 发现 + DAAN 约束执行（“能互联，更能抗恶意”）
**故事线**：Agent A 通过 ANP 的 `.well-known/agent-descriptions` 找到若干服务型 Agent（酒店/客服/计算服务）。选择其中一个后，真正的交互通道落在 DAAN 的 P2P 网络上（或通过 ANP 网关转入 P2P）。

**可量化指标**：
- 在同等发现/调用条件下，引入 DAAN 后的垃圾消息率下降、有效交互成功率上升。
- webadmin 显示限流/黑名单/可疑行为事件。

### Demo 2：恶意节点压力与仿真基准（“把抗滥用做成可复现实验”）
**故事线**：脚本启动 N 个正常节点 + M 个恶意节点（刷公告、群发邮箱、洪泛消息、女巫集群）。

**可量化指标**：
- 触发限流的时间、黑名单命中率、误杀率、恢复时间。
- 网络连通性（NAT/Relay）、消息投递成功率、延迟分布。

### Demo 3：担保入网 + 连带责任结算（“把女巫变贵”）
**故事线**：新节点必须通过担保加入；随后模拟被担保节点违规，触发责任结算与声誉惩罚，并在事件账本中存证。

**可量化指标**：
- 女巫节点规模扩张的成本曲线（担保上限/邀请成本/冷却期）。
- 违规后 sponsor 的损失与网络整体恢复速度。

---

## 5. 发展方向（建议）

- **主线**：DAAN 定位为 **ANP 生态的“P2P 执行/约束/信任层”**，而不是再造一个语义层协议。
- **短期（1-2 个里程碑）**：
  - 发布本节点的 ANP 兼容 Agent 描述与 `.well-known/agent-descriptions`（可先是最小版）。
  - 明确并统一“节点身份”表示（PeerID、NodeID、签名算法）对外口径；把 DID 作为对外身份入口。
- **中期**：实现“ANP 网关”（HTTP/JSON-LD 接入 → DAAN P2P 传输/治理执行），把 3 个 demo 固化成可一键复现实验。
