# Task 27: å§”æ‰˜ä»»åŠ¡ä¸æ–‡ä»¶ä¼ è¾“

> **çŠ¶æ€**: âœ… å®ç°å®Œæˆ  
> **ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒåŠŸèƒ½)  
> **å®Œæˆæ—¥æœŸ**: 2026-02-05  
> **ä¾èµ–**: Task 05 å£°èª‰, Task 11 æ¿€åŠ±, Task 14 æ¶ˆæ¯ç­¾å, Task 26 å…±è¯†æœºåˆ¶

## ğŸ“¦ å®ç°æ¨¡å—

| æ¨¡å— | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| ä»»åŠ¡ç®¡ç† | `internal/task/` | ä»»åŠ¡å‘å¸ƒã€ç«æ ‡ã€æŠ¢å•ã€åˆ†é… |
| æŠ¼é‡‘æ‰˜ç®¡ | `internal/escrow/` | å¤šæ–¹æŠ¼é‡‘ã€ç­¾åé‡Šæ”¾ã€äº‰è®®å¤„ç† |
| æ–‡ä»¶ä¼ è¾“ | `internal/transfer/` | åˆ†å—ä¼ è¾“ã€æ–­ç‚¹ç»­ä¼ ã€å¸¦å®½æ§åˆ¶ |
| äº‰è®®å¤„ç† | `internal/dispute/` | è¯æ®æäº¤ã€è‡ªåŠ¨ä»²è£ã€å§”å‘˜ä¼šæŠ•ç¥¨ |

## âœ… æµ‹è¯•è¦†ç›–

- `task_test.go`: 15ä¸ªæµ‹è¯•
- `escrow_test.go`: 14ä¸ªæµ‹è¯•  
- `transfer_test.go`: 15ä¸ªæµ‹è¯•
- `dispute_test.go`: 15ä¸ªæµ‹è¯•
- **å…¨éƒ¨é€šè¿‡** âœ…

---

## ğŸ¤” é—®é¢˜åˆ†æ

### æ ¸å¿ƒåœºæ™¯

```
åœºæ™¯1: æ–‡ä»¶/èµ„æºæœç´¢
  Agent A å§”æ‰˜ Agent B æœç´¢ä¸€ä¸ªæ–‡ä»¶æˆ–ç”µå½±

åœºæ™¯2: æ–‡ä»¶å­˜å‚¨/ä¼ è¾“
  Agent A å§”æ‰˜ Agent B å­˜å‚¨æˆ–ä¼ è¾“æ–‡ä»¶

åœºæ™¯3: ä»»åŠ¡åä½œ
  Agent A å§”æ‰˜ Agent B å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼ˆå¦‚ç¼–å†™PPTï¼‰
```

### æ½œåœ¨é—®é¢˜æ¸…å•

| ç¼–å· | é—®é¢˜ç±»å‹ | æè¿° | æ”»å‡»è€… | å—å®³è€… |
|:---:|---------|------|:------:|:------:|
| P-01 | æ»¥å‘æ”»å‡» | èŠ‚ç‚¹Aå‘å¸ƒå¤§é‡ä»»åŠ¡/æ¶ˆæ¯ï¼Œé€ æˆç½‘ç»œé˜»å¡ | A | ç½‘ç»œ |
| P-02 | æœ‰å®³å§”æ‰˜ | å§”æ‰˜æ”»å‡»ã€DDOSã€éæ³•å†…å®¹ä¸‹è½½ | A | B/ç½‘ç»œ |
| P-03 | è™šå‡å®Œæˆ | Bæ²¡å®Œæˆä½†è°ç§°å®Œæˆ | B | A |
| P-04 | è™šå‡å¦è®¤ | Aæ”¶åˆ°æˆæœä½†å¦è®¤ | A | B |
| P-05 | éšç§æ³„éœ² | å§”æ‰˜å†…å®¹å«éšç§ï¼Œè¢«ç¬¬ä¸‰æ–¹çªƒå– | ä¸­é—´äºº | A |
| P-06 | æµé‡æ»¥ç”¨ | Aæ— é™åˆ¶ä»Bä¸‹è½½æ–‡ä»¶ | A | B |
| P-07 | èµ„æºè€—å°½ | æ¶æ„ä»»åŠ¡æ¶ˆè€—Bçš„è®¡ç®—èµ„æº | A | B |
| P-08 | ä¸­é—´äººç¯¡æ”¹ | ä¼ è¾“è¿‡ç¨‹ä¸­æ–‡ä»¶è¢«ç¯¡æ”¹ | ä¸­é—´äºº | A/B |
| P-09 | æ‹’ç»æœåŠ¡ | Aå‘å¸ƒä»»åŠ¡åæ¶ˆå¤±ï¼ŒBæ— æ³•äº¤ä»˜ | A | B |
| P-10 | æŠ¢è·‘æ”»å‡» | Cå·çœ‹ä»»åŠ¡å†…å®¹åæŠ¢å…ˆå®Œæˆ | C | B |

---

## ï¿½ ä»»åŠ¡å‘å¸ƒä¸æ¥å•æœºåˆ¶

### æ ¸å¿ƒé—®é¢˜

```
Q1: ä»»åŠ¡åœ¨å“ªé‡Œå‘å¸ƒï¼Ÿ
Q2: èŠ‚ç‚¹Bã€Cã€Då¦‚ä½•å‘ç°ä»»åŠ¡ï¼Ÿ
Q3: å¤šä¸ªèŠ‚ç‚¹æ”¶åˆ°ä»»åŠ¡ï¼Œéƒ½è¦æ‰§è¡Œå—ï¼Ÿ
Q4: Agentå¦‚ä½•è‡ªä¸»åˆ¤æ–­æ˜¯å¦æ¥å•ï¼Ÿ
```

### å…³é”®æ´å¯Ÿï¼šAgent â‰  åŒºå—é“¾èŠ‚ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒºå—é“¾èŠ‚ç‚¹ vs AgentèŠ‚ç‚¹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   åŒºå—é“¾èŠ‚ç‚¹                        Agent èŠ‚ç‚¹                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚  è§„åˆ™   â”‚                      â”‚  æ™ºèƒ½ä½“  â”‚                 â”‚
â”‚   â”‚  é©±åŠ¨   â”‚                      â”‚  (LLM)  â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚                                â”‚                       â”‚
â”‚        â–¼                                â–¼                       â”‚
â”‚   if (æ¡ä»¶æ»¡è¶³) {                  "è®©æˆ‘åˆ†æä¸€ä¸‹..."            â”‚
â”‚     è‡ªåŠ¨æ‰§è¡Œ();                    "æŠ¥é…¬æ˜¯å¦åˆç†ï¼Ÿ"             â”‚
â”‚   }                                "æˆ‘æ“…é•¿è¿™ç±»ä»»åŠ¡å—ï¼Ÿ"         â”‚
â”‚                                    "å‘å¸ƒè€…ä¿¡èª‰å¦‚ä½•ï¼Ÿ"           â”‚
â”‚                                                                 â”‚
â”‚   âŒ æ— åˆ¤æ–­åŠ›                       âœ… è‡ªä¸»å†³ç­–                  â”‚
â”‚   âŒ æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç›¸åŒé€»è¾‘           âœ… æ¯ä¸ªAgentæœ‰ä¸åŒèƒ½åŠ›/åå¥½  â”‚
â”‚   âŒ ç¡®å®šæ€§è¾“å‡º                     âœ… åˆ›é€ æ€§è¾“å‡º                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»»åŠ¡å‘å¸ƒæ¨¡å¼

#### æ¨¡å¼1: å¹¿æ’­å¸‚åœº (Task Marketplace)

```
é€‚ç”¨ï¼šé€šç”¨ä»»åŠ¡ï¼Œä¸åœ¨ä¹è°æ¥æ‰§è¡Œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä»»åŠ¡å¸‚åœº                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Task #001: æœç´¢å…³äºAIçš„è®ºæ–‡      å¥–åŠ±: 5å£°èª‰  æˆªæ­¢: 2h   â”‚   â”‚
â”‚  â”‚ Task #002: ç¿»è¯‘ä¸€ç¯‡æ–‡æ¡£          å¥–åŠ±: 10å£°èª‰ æˆªæ­¢: 4h   â”‚   â”‚
â”‚  â”‚ Task #003: ç¼–å†™PPTå¤§çº²           å¥–åŠ±: 15å£°èª‰ æˆªæ­¢: 1d   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â–¼                  â–¼                  â–¼                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ Agent B â”‚       â”‚ Agent C â”‚        â”‚ Agent D â”‚           â”‚
â”‚    â”‚ "æˆ‘æ“…é•¿ â”‚       â”‚ "ç¿»è¯‘æ˜¯ â”‚        â”‚ "PPTæˆ‘  â”‚           â”‚
â”‚    â”‚  æœç´¢"  â”‚       â”‚  æˆ‘ä¸“é•¿" â”‚        â”‚  æ¥åš"  â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                  â”‚                  â”‚                â”‚
â”‚     ç”³è¯·#001           ç”³è¯·#002           ç”³è¯·#003              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‘å¸ƒæ–¹å¼: GossipSub å¹¿æ’­åˆ° "task-marketplace" ä¸»é¢˜
```

#### æ¨¡å¼2: å®šå‘å§”æ‰˜ (Direct Delegation)

```
é€‚ç”¨ï¼šæŒ‡å®šç‰¹å®šAgentï¼Œæˆ–æœ‰éšç§éœ€æ±‚

Agent A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Agent B
         "æˆ‘å§”æ‰˜ä½ å®Œæˆè¿™ä¸ªä»»åŠ¡"
         
å‘å¸ƒæ–¹å¼: ç‚¹å¯¹ç‚¹ç›´æ¥å‘é€
```

#### æ¨¡å¼3: èƒ½åŠ›åŒ¹é… (Capability Matching)

```
é€‚ç”¨ï¼šéœ€è¦ç‰¹å®šèƒ½åŠ›çš„ä»»åŠ¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Agent A å‘å¸ƒä»»åŠ¡ï¼Œå£°æ˜éœ€è¦çš„èƒ½åŠ›                           â”‚
â”‚     {                                                         â”‚
â”‚       "task": "åˆ†æåŒ»å­¦å½±åƒ",                                  â”‚
â”‚       "required_capabilities": ["image_analysis", "medical"], â”‚
â”‚       "min_reputation": 50                                    â”‚
â”‚     }                                                         â”‚
â”‚                                                               â”‚
â”‚  2. ç³»ç»Ÿæ ¹æ®èƒ½åŠ›æ³¨å†Œè¡¨ç­›é€‰                                     â”‚
â”‚     Agent B: [coding, search]           âŒ ä¸åŒ¹é…             â”‚
â”‚     Agent C: [image_analysis, medical]  âœ… åŒ¹é…               â”‚
â”‚     Agent D: [image_analysis]           âš ï¸ éƒ¨åˆ†åŒ¹é…           â”‚
â”‚                                                               â”‚
â”‚  3. åªé€šçŸ¥åŒ¹é…çš„Agent                                         â”‚
â”‚     â†’ Agent C æ”¶åˆ°ä»»åŠ¡é€šçŸ¥                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¥å•æœºåˆ¶ï¼šå¦‚ä½•é¿å…é‡å¤æ‰§è¡Œï¼Ÿ

#### æ–¹æ¡ˆ1: æŠ¢å•æ¨¡å¼ (First Come First Served)

```go
// æŠ¢å•æµç¨‹
type TaskClaim struct {
    TaskID      string
    ClaimerID   string    // æŠ¢å•çš„Agent
    ClaimTime   int64
    Signature   string
}

// æµç¨‹:
// 1. Agent B çœ‹åˆ°ä»»åŠ¡ï¼Œå‘é€ ClaimRequest
// 2. å‘å¸ƒè€… A æ”¶åˆ°ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„ Claim
// 3. A å¹¿æ’­ TaskAssigned{TaskID, AssignedTo: B}
// 4. å…¶ä»–Agentæ”¶åˆ°åæ”¾å¼ƒè¯¥ä»»åŠ¡
```

```
æ—¶é—´çº¿ï¼š
T0: A å‘å¸ƒä»»åŠ¡
T1: B å‘é€ Claim (ç½‘ç»œå»¶è¿Ÿ 50ms)
T2: C å‘é€ Claim (ç½‘ç»œå»¶è¿Ÿ 80ms)
T3: A æ”¶åˆ° B çš„ Claimï¼Œç¡®è®¤åˆ†é…ç»™ B
T4: A å¹¿æ’­ TaskAssigned â†’ B
T5: C æ”¶åˆ° TaskAssignedï¼Œæ”¾å¼ƒä»»åŠ¡

é—®é¢˜ï¼šç½‘ç»œå»¶è¿Ÿå¯èƒ½å¯¼è‡´ä¸å…¬å¹³
```

#### æ–¹æ¡ˆ2: ç«æ ‡æ¨¡å¼ (Bidding) ã€æ¨èã€‘

```go
// ç«æ ‡æµç¨‹
type TaskBid struct {
    TaskID          string
    BidderID        string
    BidAmount       float64   // æ„¿æ„æ¥å—çš„æœ€ä½æŠ¥é…¬ï¼ˆå¯ä½äºæ ‡ä»·ï¼‰
    EstimatedTime   int64     // é¢„ä¼°å®Œæˆæ—¶é—´
    Capabilities    []string  // è‡ªæˆ‘å£°æ˜çš„èƒ½åŠ›
    Reputation      float64   // å½“å‰å£°èª‰
    Message         string    // Agentçš„è‡ªæˆ‘ä»‹ç»/ç«æ ‡ç†ç”±
    Signature       string
}

// æµç¨‹:
// 1. A å‘å¸ƒä»»åŠ¡ï¼Œè®¾ç½®ç«æ ‡æœŸï¼ˆå¦‚ï¼š10åˆ†é’Ÿï¼‰
// 2. Bã€Cã€D åœ¨ç«æ ‡æœŸå†…æäº¤ Bid
// 3. ç«æ ‡æœŸç»“æŸï¼ŒA çš„ Agent è‡ªä¸»é€‰æ‹©æœ€ä½³æŠ•æ ‡è€…
// 4. A å¹¿æ’­ TaskAssigned

// Agent A çš„é€‰æ‹©é€»è¾‘ï¼ˆç”±LLMåˆ¤æ–­ï¼‰ï¼š
func (agent *Agent) SelectBestBidder(bids []TaskBid) string {
    // Agent å¯ä»¥æ ¹æ®å¤šç§å› ç´ è‡ªä¸»åˆ¤æ–­ï¼š
    // - å£°èª‰åˆ†æ•°
    // - æŠ¥ä»·
    // - é¢„ä¼°æ—¶é—´
    // - å†å²åˆä½œç»éªŒ
    // - ç«æ ‡ç†ç”±çš„è´¨é‡
    
    prompt := fmt.Sprintf(`
        æˆ‘å‘å¸ƒäº†ä¸€ä¸ªä»»åŠ¡: %s
        æ”¶åˆ°ä»¥ä¸‹ç«æ ‡:
        %v
        
        è¯·å¸®æˆ‘é€‰æ‹©æœ€åˆé€‚çš„æ‰§è¡Œè€…ï¼Œè€ƒè™‘å› ç´ ï¼š
        1. å£°èª‰å’Œå¯ä¿¡åº¦
        2. æŠ¥ä»·åˆç†æ€§
        3. èƒ½åŠ›åŒ¹é…åº¦
        4. é¢„ä¼°å®Œæˆæ—¶é—´
        
        è¿”å›ä½ é€‰æ‹©çš„Agent IDå’Œç†ç”±ã€‚
    `, task.Description, bids)
    
    return agent.LLM.Decide(prompt)
}
```

```
æ—¶é—´çº¿ï¼š
T0:     A å‘å¸ƒä»»åŠ¡ï¼ˆç«æ ‡æœŸ 10åˆ†é’Ÿï¼‰
T0-T10: Bã€Cã€D æäº¤ç«æ ‡
T10:    ç«æ ‡æœŸç»“æŸ
T11:    A çš„ Agent åˆ†ææ‰€æœ‰ç«æ ‡
T12:    A é€‰æ‹© Cï¼Œå¹¿æ’­ TaskAssigned
T13:    C å¼€å§‹æ‰§è¡Œï¼ŒBã€D æ”¶åˆ°é€šçŸ¥æ”¾å¼ƒ
```

#### æ–¹æ¡ˆ3: å¤šæ‰§è¡Œè€…æ¨¡å¼ (Multi-Executor)

```
é€‚ç”¨ï¼šéœ€è¦å¤šä¸ªç»“æœå¯¹æ¯”ã€å†—ä½™æ‰§è¡Œ

ä¾‹ï¼šA å§”æ‰˜ "åˆ†æè¿™å¼ å›¾ç‰‡ä¸­çš„ç‰©ä½“"
    â†’ Bã€Cã€D éƒ½æ‰§è¡Œ
    â†’ A æ”¶åˆ°3ä¸ªç»“æœï¼Œå¯¹æ¯”é€‰æ‹©æœ€ä½³
    â†’ æˆ–è€…åˆå¹¶3ä¸ªç»“æœ
```

```go
type MultiExecutorTask struct {
    TaskID          string
    MaxExecutors    int       // æœ€å¤šå…è®¸å¤šå°‘Agentæ‰§è¡Œ
    SelectionMode   string    // "best" | "merge" | "vote"
    RewardPerAgent  float64   // æ¯ä¸ªæ‰§è¡Œè€…çš„æŠ¥é…¬
}
```

### Agent è‡ªä¸»å†³ç­–ï¼šæ˜¯å¦æ¥å•ï¼Ÿ

```go
// AgentDecisionContext å†³ç­–ä¸Šä¸‹æ–‡
type AgentDecisionContext struct {
    // ä»»åŠ¡ä¿¡æ¯
    Task            *Task
    
    // å‘å¸ƒè€…ä¿¡æ¯
    RequesterID     string
    RequesterRep    float64
    PastInteractions int      // å†å²åˆä½œæ¬¡æ•°
    PastSuccessRate float64   // å†å²æˆåŠŸç‡
    
    // è‡ªèº«çŠ¶æ€
    CurrentWorkload int       // å½“å‰ä»»åŠ¡æ•°
    MyCapabilities  []string  // æˆ‘çš„èƒ½åŠ›
    MyReputation    float64   // æˆ‘çš„å£°èª‰
    
    // å¸‚åœºçŠ¶æ€
    CompetitorCount int       // å¤šå°‘äººä¹Ÿåœ¨çœ‹è¿™ä¸ªä»»åŠ¡
    MarketRate      float64   // ç±»ä¼¼ä»»åŠ¡çš„å¸‚åœºå¹³å‡æŠ¥é…¬
}

// Agent å†³ç­–è¿‡ç¨‹
func (agent *Agent) DecideToAccept(ctx *AgentDecisionContext) (bool, string) {
    // æ„å»ºå†³ç­–prompt
    prompt := fmt.Sprintf(`
        # ä»»åŠ¡è¯„ä¼°
        
        ## ä»»åŠ¡è¯¦æƒ…
        - ç±»å‹: %s
        - æè¿°: %s
        - æŠ¥é…¬: %.1f å£°èª‰ç‚¹
        - æˆªæ­¢: %s
        
        ## å‘å¸ƒè€…ä¿¡æ¯
        - å£°èª‰: %.1f
        - å†å²åˆä½œ: %d æ¬¡
        - æˆåŠŸç‡: %.1f%%
        
        ## æˆ‘çš„çŠ¶æ€
        - å½“å‰ä»»åŠ¡æ•°: %d
        - æˆ‘çš„èƒ½åŠ›: %v
        - æˆ‘çš„å£°èª‰: %.1f
        
        ## å¸‚åœºæƒ…å†µ
        - ç«äº‰è€…æ•°é‡: %d
        - å¸‚åœºå¹³å‡ä»·: %.1f
        
        è¯·åˆ¤æ–­ï¼š
        1. æˆ‘æ˜¯å¦åº”è¯¥æ¥å—è¿™ä¸ªä»»åŠ¡ï¼Ÿ
        2. å¦‚æœç«æ ‡ï¼Œæˆ‘çš„æŠ¥ä»·åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ
        3. ç†ç”±æ˜¯ä»€ä¹ˆï¼Ÿ
        
        è¿”å›JSON: {"accept": true/false, "bid": é‡‘é¢, "reason": "ç†ç”±"}
    `, ctx.Task.Type, ctx.Task.Description, ctx.Task.Reward, 
       time.Unix(ctx.Task.Deadline, 0).Format("2006-01-02 15:04"),
       ctx.RequesterRep, ctx.PastInteractions, ctx.PastSuccessRate*100,
       ctx.CurrentWorkload, ctx.MyCapabilities, ctx.MyReputation,
       ctx.CompetitorCount, ctx.MarketRate)
    
    response := agent.LLM.Think(prompt)
    return parseDecision(response)
}
```

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»»åŠ¡å‘å¸ƒä¸æ‰§è¡Œå®Œæ•´æµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ Agent A â”‚ 1. å‘å¸ƒä»»åŠ¡                                               â”‚
â”‚  â”‚ (å‘å¸ƒè€…) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚                 â”‚
â”‚       â”‚                                              â–¼                 â”‚
â”‚       â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚       â”‚                                    â”‚   ä»»åŠ¡å¸‚åœº/     â”‚         â”‚
â”‚       â”‚                                    â”‚  GossipSubå¹¿æ’­  â”‚         â”‚
â”‚       â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚                                             â”‚                  â”‚
â”‚       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚       â”‚                    â–¼                        â–¼            â–¼     â”‚
â”‚       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚       â”‚              â”‚ Agent B â”‚             â”‚ Agent C â”‚  â”‚ Agent D â”‚ â”‚
â”‚       â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                   â”‚                       â”‚            â”‚      â”‚
â”‚       â”‚          2. Agentè‡ªä¸»åˆ¤æ–­            Agentè‡ªä¸»åˆ¤æ–­   Agentåˆ¤æ–­ â”‚
â”‚       â”‚              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”‚
â”‚       â”‚              â”‚ LLMæ€è€ƒ  â”‚             â”‚ LLMæ€è€ƒ  â”‚  â”‚ LLMæ€è€ƒ  â”‚ â”‚
â”‚       â”‚              â”‚ "æŠ¥é…¬ä½ â”‚             â”‚ "è¿™ä¸ªæˆ‘ â”‚  â”‚ "å¤ªå¿™äº† â”‚ â”‚
â”‚       â”‚              â”‚  ä¸æ¥"  â”‚             â”‚  æ“…é•¿"  â”‚  â”‚  æ”¾å¼ƒ"  â”‚ â”‚
â”‚       â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                   â”‚                       â”‚            â”‚      â”‚
â”‚       â”‚                   âŒ                      âœ…            âŒ     â”‚
â”‚       â”‚                  æ”¾å¼ƒ                   æäº¤ç«æ ‡       æ”¾å¼ƒ    â”‚
â”‚       â”‚                                          â”‚                    â”‚
â”‚       â”‚  3. æ”¶é›†ç«æ ‡                             â”‚                    â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚       â”‚                                                                â”‚
â”‚       â”‚  4. Agent A è‡ªä¸»é€‰æ‹©                                          â”‚
â”‚       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚       â”‚     â”‚ LLMåˆ†æ: "Cçš„å£°èª‰é«˜ï¼ŒæŠ¥ä»·åˆç†ï¼Œé€‰C" â”‚                  â”‚
â”‚       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                                                â”‚
â”‚       â”‚  5. å¹¿æ’­ä»»åŠ¡åˆ†é…                                              â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
â”‚       â”‚                                              â”‚                 â”‚
â”‚       â”‚                                              â–¼                 â”‚
â”‚       â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚                                        â”‚ Agent C â”‚            â”‚
â”‚       â”‚                                        â”‚  æ‰§è¡Œä¸­  â”‚            â”‚
â”‚       â”‚                                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚                                             â”‚                  â”‚
â”‚       â”‚  6. æäº¤äº¤ä»˜                                â”‚                  â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                                                â”‚
â”‚       â”‚  7. Agent A éªŒæ”¶                                              â”‚
â”‚       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚       â”‚     â”‚ LLMè¯„ä¼°: "è´¨é‡ç¬¦åˆè¦æ±‚ï¼Œç¡®è®¤å®Œæˆ"    â”‚                  â”‚
â”‚       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                                                â”‚
â”‚       â”‚  8. ç»“ç®— + åŒæ–¹äº’è¯„                                           â”‚
â”‚       â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®ç»“æ„è¡¥å……

```go
// TaskPublication ä»»åŠ¡å‘å¸ƒ
type TaskPublication struct {
    Task            *Task
    PublishMode     PublishMode   // broadcast | direct | capability_match
    BiddingPeriod   time.Duration // ç«æ ‡æœŸï¼Œ0è¡¨ç¤ºæŠ¢å•æ¨¡å¼
    MaxExecutors    int           // æœ€å¤§æ‰§è¡Œè€…æ•°ï¼Œ1è¡¨ç¤ºå•æ‰§è¡Œè€…
    RequiredCaps    []string      // è¦æ±‚çš„èƒ½åŠ›
    MinReputation   float64       // æœ€ä½å£°èª‰è¦æ±‚
}

type PublishMode string

const (
    ModeBroadcast       PublishMode = "broadcast"        // å¹¿æ’­åˆ°å¸‚åœº
    ModeDirect          PublishMode = "direct"           // å®šå‘å§”æ‰˜
    ModeCapabilityMatch PublishMode = "capability_match" // èƒ½åŠ›åŒ¹é…
)

// AgentCapability Agentèƒ½åŠ›æ³¨å†Œ
type AgentCapability struct {
    AgentID         string
    Capabilities    []string  // ["coding", "search", "translation", "image_analysis"]
    Languages       []string  // ["zh", "en", "ja"]
    MaxConcurrent   int       // æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
    AvailableHours  []int     // å¯ç”¨æ—¶æ®µ [9,10,11,...,18]
    UpdatedAt       int64
}

// èƒ½åŠ›æ³¨å†Œè¡¨ï¼ˆDHTå­˜å‚¨ï¼‰
// Key: /capabilities/{capability_name}
// Value: []AgentID
```

### é˜²é‡å¤æ‰§è¡Œæœºåˆ¶

```go
// TaskLock ä»»åŠ¡é”
type TaskLock struct {
    TaskID      string
    LockedBy    string    // è¢«åˆ†é…ç»™è°
    LockedAt    int64
    Signature   string    // å‘å¸ƒè€…ç­¾åç¡®è®¤
}

// æ‰§è¡Œå‰æ£€æŸ¥
func (agent *Agent) BeforeExecute(taskID string) error {
    // 1. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²è¢«é”å®š
    lock := agent.GetTaskLock(taskID)
    if lock != nil && lock.LockedBy != agent.ID {
        return ErrTaskAlreadyAssigned
    }
    
    // 2. æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
    task := agent.GetTask(taskID)
    if task.Status != StatusAccepted {
        return ErrInvalidTaskStatus
    }
    
    // 3. ç¡®è®¤æ˜¯åˆ†é…ç»™è‡ªå·±çš„
    if task.ExecutorID != agent.ID {
        return ErrNotAssignedToMe
    }
    
    return nil
}
```

---

## ï¿½ğŸ—ï¸ æ•´ä½“æ¶æ„

### å§”æ‰˜ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å§”æ‰˜ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 1.å‘å¸ƒ   â”‚â”€â”€â”€>â”‚ 2.æ¥å—   â”‚â”€â”€â”€>â”‚ 3.æ‰§è¡Œ   â”‚â”€â”€â”€>â”‚ 4.äº¤ä»˜   â”‚         â”‚
â”‚  â”‚ PUBLISH â”‚    â”‚ ACCEPT  â”‚    â”‚ EXECUTE â”‚    â”‚ DELIVER â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚              â”‚              â”‚              â”‚               â”‚
â”‚       â–¼              â–¼              â–¼              â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 5.éªŒæ”¶   â”‚â”€â”€â”€>â”‚ 6.ç»“ç®—   â”‚â”€â”€â”€>â”‚ 7.è¯„ä»·   â”‚â”€â”€â”€>â”‚ 8.å½’æ¡£   â”‚         â”‚
â”‚  â”‚ VERIFY  â”‚    â”‚ SETTLE  â”‚    â”‚ RATE    â”‚    â”‚ ARCHIVE â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                     â”‚
â”‚  çŠ¶æ€æµè½¬:                                                          â”‚
â”‚  DRAFT â†’ PUBLISHED â†’ ACCEPTED â†’ IN_PROGRESS â†’ DELIVERED            â”‚
â”‚       â†’ VERIFIED â†’ SETTLED â†’ COMPLETED                              â”‚
â”‚                                                                     â”‚
â”‚  å¼‚å¸¸åˆ†æ”¯:                                                          â”‚
â”‚  ä»»æ„é˜¶æ®µ â†’ DISPUTED â†’ ARBITRATION â†’ RESOLVED                       â”‚
â”‚  è¶…æ—¶    â†’ EXPIRED / CANCELLED                                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚é˜²æŠ¤æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: å‡†å…¥æ§åˆ¶                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ å£°èª‰é—¨æ§›     â”‚  â”‚ æŠ¼é‡‘é”å®š     â”‚  â”‚ é€Ÿç‡é™åˆ¶     â”‚              â”‚
â”‚  â”‚ (å‘ä»»åŠ¡éœ€30+)â”‚  â”‚ (åŒæ–¹æŠ¼é‡‘)   â”‚  â”‚ (æ¯å°æ—¶Nä¸ª)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: è¿‡ç¨‹ä¿æŠ¤                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ç«¯åˆ°ç«¯åŠ å¯†   â”‚  â”‚ å†…å®¹å“ˆå¸Œ     â”‚  â”‚ è¿›åº¦è¿½è¸ª     â”‚              â”‚
â”‚  â”‚ (éšç§ä¿æŠ¤)   â”‚  â”‚ (é˜²ç¯¡æ”¹)     â”‚  â”‚ (è¶…æ—¶æ£€æµ‹)   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: äº‰è®®è§£å†³                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ è‡ªåŠ¨ä»²è£     â”‚  â”‚ å§”å‘˜ä¼šè£å†³   â”‚  â”‚ å£°èª‰æƒ©ç½š     â”‚              â”‚
â”‚  â”‚ (è§„åˆ™åŒ¹é…)   â”‚  â”‚ (äººå·¥ä»‹å…¥)   â”‚  â”‚ (è¿è§„è®°å½•)   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ•°æ®ç»“æ„è®¾è®¡

### 1. å§”æ‰˜ä»»åŠ¡ (Task)

```go
// TaskType ä»»åŠ¡ç±»å‹
type TaskType string

const (
    TaskTypeSearch    TaskType = "search"     // æœç´¢ä»»åŠ¡
    TaskTypeTransfer  TaskType = "transfer"   // æ–‡ä»¶ä¼ è¾“
    TaskTypeStorage   TaskType = "storage"    // æ–‡ä»¶å­˜å‚¨
    TaskTypeCompute   TaskType = "compute"    // è®¡ç®—ä»»åŠ¡
    TaskTypeCustom    TaskType = "custom"     // è‡ªå®šä¹‰ä»»åŠ¡
)

// TaskStatus ä»»åŠ¡çŠ¶æ€
type TaskStatus string

const (
    StatusDraft      TaskStatus = "draft"
    StatusPublished  TaskStatus = "published"
    StatusAccepted   TaskStatus = "accepted"
    StatusInProgress TaskStatus = "in_progress"
    StatusDelivered  TaskStatus = "delivered"
    StatusVerified   TaskStatus = "verified"
    StatusSettled    TaskStatus = "settled"
    StatusCompleted  TaskStatus = "completed"
    StatusDisputed   TaskStatus = "disputed"
    StatusCancelled  TaskStatus = "cancelled"
    StatusExpired    TaskStatus = "expired"
)

// Task å§”æ‰˜ä»»åŠ¡
type Task struct {
    // åŸºæœ¬ä¿¡æ¯
    ID              string      `json:"id"`
    Type            TaskType    `json:"type"`
    Title           string      `json:"title"`
    Description     string      `json:"description"`      // å¯åŠ å¯†
    
    // å‚ä¸æ–¹
    RequesterID     string      `json:"requester_id"`     // å§”æ‰˜æ–¹
    ExecutorID      string      `json:"executor_id"`      // æ‰§è¡Œæ–¹ï¼ˆæ¥å—åå¡«å…¥ï¼‰
    
    // å¥–åŠ±ä¸æŠ¼é‡‘
    Reward          float64     `json:"reward"`           // å£°èª‰å¥–åŠ±
    RequesterDeposit float64    `json:"requester_deposit"` // å§”æ‰˜æ–¹æŠ¼é‡‘
    ExecutorDeposit float64     `json:"executor_deposit"`  // æ‰§è¡Œæ–¹æŠ¼é‡‘
    
    // æ—¶é—´çº¦æŸ
    CreatedAt       int64       `json:"created_at"`
    Deadline        int64       `json:"deadline"`         // æˆªæ­¢æ—¶é—´
    ExpiresAt       int64       `json:"expires_at"`       // ä»»åŠ¡è¿‡æœŸæ—¶é—´
    
    // éªŒæ”¶æ¡ä»¶
    AcceptanceCriteria string   `json:"acceptance_criteria"` // éªŒæ”¶æ ‡å‡†
    DeliverableHash    string   `json:"deliverable_hash"`    // äº¤ä»˜ç‰©å“ˆå¸Œï¼ˆå¯é€‰ï¼‰
    
    // çŠ¶æ€
    Status          TaskStatus  `json:"status"`
    
    // éšç§ä¿æŠ¤
    IsEncrypted     bool        `json:"is_encrypted"`     // æè¿°æ˜¯å¦åŠ å¯†
    PublicKeyHash   string      `json:"public_key_hash"`  // æ‰§è¡Œæ–¹å…¬é’¥å“ˆå¸Œï¼ˆè§£å¯†ç”¨ï¼‰
    
    // ç­¾å
    RequesterSig    string      `json:"requester_sig"`
    ExecutorSig     string      `json:"executor_sig"`
    Nonce           string      `json:"nonce"`
}
```

### 2. æ–‡ä»¶ä¼ è¾“è¯·æ±‚ (TransferRequest)

```go
// TransferRequest æ–‡ä»¶ä¼ è¾“è¯·æ±‚
type TransferRequest struct {
    ID              string      `json:"id"`
    TaskID          string      `json:"task_id"`          // å…³è”çš„ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
    
    // å‚ä¸æ–¹
    SenderID        string      `json:"sender_id"`
    ReceiverID      string      `json:"receiver_id"`
    
    // æ–‡ä»¶ä¿¡æ¯
    FileHash        string      `json:"file_hash"`        // æ–‡ä»¶SM3å“ˆå¸Œ
    FileName        string      `json:"file_name"`
    FileSize        int64       `json:"file_size"`        // å­—èŠ‚
    ChunkSize       int64       `json:"chunk_size"`       // åˆ†ç‰‡å¤§å°
    TotalChunks     int         `json:"total_chunks"`
    
    // æµé‡æ§åˆ¶
    MaxBandwidth    int64       `json:"max_bandwidth"`    // æœ€å¤§å¸¦å®½(bytes/s)
    
    // æŠ¼é‡‘ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
    SenderDeposit   float64     `json:"sender_deposit"`
    ReceiverDeposit float64     `json:"receiver_deposit"`
    
    // çŠ¶æ€
    Status          TransferStatus `json:"status"`
    Progress        float64     `json:"progress"`         // 0-1
    
    // æ—¶é—´
    CreatedAt       int64       `json:"created_at"`
    ExpiresAt       int64       `json:"expires_at"`
    
    // ç­¾å
    Signatures      []string    `json:"signatures"`
}

// TransferChunk ä¼ è¾“åˆ†ç‰‡
type TransferChunk struct {
    TransferID      string      `json:"transfer_id"`
    Index           int         `json:"index"`
    Data            []byte      `json:"data"`
    Hash            string      `json:"hash"`             // åˆ†ç‰‡å“ˆå¸Œ
    Signature       string      `json:"signature"`
}
```

### 3. æŠ¼é‡‘ç³»ç»Ÿ (Escrow)

```go
// Escrow æŠ¼é‡‘æ‰˜ç®¡
type Escrow struct {
    ID              string      `json:"id"`
    TaskID          string      `json:"task_id"`
    
    // æŠ¼é‡‘æ˜ç»†
    Deposits        map[string]float64 `json:"deposits"`  // nodeID -> amount
    TotalAmount     float64     `json:"total_amount"`
    
    // çŠ¶æ€
    Status          EscrowStatus `json:"status"`
    
    // é‡Šæ”¾æ¡ä»¶
    ReleaseCondition string     `json:"release_condition"`
    ReleasedTo       string     `json:"released_to"`
    ReleasedAmount   float64    `json:"released_amount"`
    
    // å¤šç­¾åé”å®š
    LockSignatures  []string    `json:"lock_signatures"`
    UnlockSignatures []string   `json:"unlock_signatures"`
    
    CreatedAt       int64       `json:"created_at"`
    LockedUntil     int64       `json:"locked_until"`
}

type EscrowStatus string

const (
    EscrowPending   EscrowStatus = "pending"
    EscrowLocked    EscrowStatus = "locked"
    EscrowReleased  EscrowStatus = "released"
    EscrowDisputed  EscrowStatus = "disputed"
    EscrowRefunded  EscrowStatus = "refunded"
)
```

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶è®¾è®¡

### P-01: æ»¥å‘æ”»å‡»é˜²æŠ¤

```go
// TaskRateLimiter ä»»åŠ¡é€Ÿç‡é™åˆ¶å™¨
type TaskRateLimiter struct {
    // åŸºäºå£°èª‰çš„é…é¢
    BaseQuota           int       // åŸºç¡€é…é¢ï¼ˆå¦‚ï¼šæ¯å°æ—¶2ä¸ªä»»åŠ¡ï¼‰
    ReputationMultiplier float64  // å£°èª‰ä¹˜æ•°ï¼ˆå¦‚ï¼šå£°èª‰/20ï¼‰
    
    // å†·å´æœºåˆ¶
    CooldownAfterReject time.Duration // è¢«æ‹’ç»åå†·å´æœŸ
    
    // å½“å‰çŠ¶æ€
    quotaUsed       map[string]int       // nodeID -> å·²ç”¨é…é¢
    lastReset       map[string]time.Time // nodeID -> ä¸Šæ¬¡é‡ç½®æ—¶é—´
}

// è®¡ç®—èŠ‚ç‚¹é…é¢
func (r *TaskRateLimiter) GetQuota(nodeID string, reputation float64) int {
    base := r.BaseQuota
    bonus := int(reputation * r.ReputationMultiplier)
    return base + bonus
    // ä¾‹ï¼šå£°èª‰=50 â†’ 2 + 50/20 = 4.5 â†’ 4ä¸ªä»»åŠ¡/å°æ—¶
}

// æ¶ˆæ¯å¤§å°é™åˆ¶
const (
    MaxTaskDescriptionSize = 10 * 1024    // 10KB
    MaxAttachmentSize      = 1 * 1024 * 1024 // 1MB
)
```

### P-02: æœ‰å®³å§”æ‰˜è¿‡æ»¤

```go
// TaskFilter ä»»åŠ¡è¿‡æ»¤å™¨
type TaskFilter struct {
    // é»‘åå•å…³é”®è¯
    BlacklistKeywords []string
    
    // ä»»åŠ¡ç±»å‹ç™½åå•
    AllowedTaskTypes  []TaskType
    
    // èµ„æºé™åˆ¶
    MaxComputeTime    time.Duration  // æœ€å¤§è®¡ç®—æ—¶é—´
    MaxMemoryUsage    int64          // æœ€å¤§å†…å­˜ä½¿ç”¨
    MaxNetworkCalls   int            // æœ€å¤§ç½‘ç»œè°ƒç”¨æ•°
    
    // æ²™ç®±æ‰§è¡Œ
    SandboxEnabled    bool
}

// ä»»åŠ¡åˆ†ç±»
type TaskRiskLevel string

const (
    RiskLow     TaskRiskLevel = "low"      // æœç´¢ã€æŸ¥è¯¢
    RiskMedium  TaskRiskLevel = "medium"   // æ–‡ä»¶ä¼ è¾“
    RiskHigh    TaskRiskLevel = "high"     // è®¡ç®—ä»»åŠ¡
    RiskBlocked TaskRiskLevel = "blocked"  // ç¦æ­¢æ‰§è¡Œ
)

// è¯„ä¼°ä»»åŠ¡é£é™©
func (f *TaskFilter) AssessRisk(task *Task) TaskRiskLevel {
    // 1. å…³é”®è¯æ£€æŸ¥
    if containsBlacklist(task.Description, f.BlacklistKeywords) {
        return RiskBlocked
    }
    
    // 2. ç±»å‹æ£€æŸ¥
    switch task.Type {
    case TaskTypeSearch:
        return RiskLow
    case TaskTypeTransfer, TaskTypeStorage:
        return RiskMedium
    case TaskTypeCompute:
        return RiskHigh
    default:
        return RiskMedium
    }
}
```

### P-03 & P-04: é˜²æ­¢è™šå‡å£°æ˜ï¼ˆåŒå‘ä¿æŠ¤ï¼‰

```go
// æ‰¿è¯º-æ­ç¤ºæœºåˆ¶ (Commit-Reveal)
type CommitRevealProtocol struct {
    // é˜¶æ®µ1: æ‰§è¡Œæ–¹æäº¤äº¤ä»˜ç‰©å“ˆå¸Œï¼ˆä¸æ­ç¤ºå†…å®¹ï¼‰
    DeliverableCommit   string    // Hash(äº¤ä»˜ç‰© + éšæœºæ•°)
    CommitTimestamp     int64
    
    // é˜¶æ®µ2: å§”æ‰˜æ–¹ç¡®è®¤æ”¶åˆ°ï¼ˆé”å®šèµ„é‡‘ï¼‰
    ReceivedAck         bool
    AckTimestamp        int64
    
    // é˜¶æ®µ3: æ‰§è¡Œæ–¹æ­ç¤ºäº¤ä»˜ç‰©
    DeliverableReveal   []byte    // å®é™…äº¤ä»˜ç‰©
    RevealNonce         string    // éšæœºæ•°
    
    // é˜¶æ®µ4: éªŒè¯åŒ¹é…
    Verified            bool
}

// æµç¨‹:
// 1. Bå®Œæˆä»»åŠ¡ï¼Œè®¡ç®— commit = Hash(result + nonce)ï¼Œå‘é€commitç»™A
// 2. Aæ”¶åˆ°commitï¼Œå‘é€ACKï¼ˆæ­¤æ—¶Aè¿˜æ²¡çœ‹åˆ°resultï¼‰
// 3. Bæ”¶åˆ°ACKåï¼Œå‘é€ (result, nonce)
// 4. AéªŒè¯ Hash(result + nonce) == commit
// 5. å¦‚æœAä¸å‘ACKï¼Œè¶…æ—¶åBå¯ç”³è¯‰
// 6. å¦‚æœBä¸æ­ç¤ºï¼Œè¶…æ—¶åAå¯å–å›æŠ¼é‡‘
```

```go
// äº¤ä»˜è¯æ˜ (Proof of Delivery)
type DeliveryProof struct {
    TaskID          string
    DeliverableHash string    // äº¤ä»˜ç‰©å“ˆå¸Œ
    
    // æ‰§è¡Œæ–¹è¯æ˜
    ExecutorSig     string    // Bç­¾åï¼šæˆ‘äº¤ä»˜äº†è¿™ä¸ª
    DeliveryTime    int64
    
    // å§”æ‰˜æ–¹ç¡®è®¤
    RequesterSig    string    // Aç­¾åï¼šæˆ‘æ”¶åˆ°äº†è¿™ä¸ª
    ReceiveTime     int64
    
    // ç¬¬ä¸‰æ–¹è§è¯ï¼ˆå¯é€‰ï¼Œç”¨äºäº‰è®®ï¼‰
    WitnessSigs     []string  // è§è¯èŠ‚ç‚¹ç­¾å
}

// éªŒè¯äº¤ä»˜è¯æ˜
func (p *DeliveryProof) Verify() error {
    // å¿…é¡»åŒæ—¶æœ‰åŒæ–¹ç­¾åæ‰ç®—æœ‰æ•ˆäº¤ä»˜
    if p.ExecutorSig == "" || p.RequesterSig == "" {
        return ErrIncompleteProof
    }
    // éªŒè¯ç­¾å...
    return nil
}
```

### P-05: éšç§ä¿æŠ¤

```go
// ç«¯åˆ°ç«¯åŠ å¯†ä»»åŠ¡
type EncryptedTask struct {
    // å…¬å¼€éƒ¨åˆ†ï¼ˆæ‰€æœ‰äººå¯è§ï¼‰
    TaskID          string
    Type            TaskType
    RequesterID     string
    Reward          float64
    Deadline        int64
    
    // åŠ å¯†éƒ¨åˆ†ï¼ˆåªæœ‰æ‰§è¡Œæ–¹å¯è§£å¯†ï¼‰
    EncryptedPayload []byte   // SM4åŠ å¯†çš„ä»»åŠ¡è¯¦æƒ…
    
    // å¯†é’¥äº¤æ¢
    EphemeralPubKey string    // å§”æ‰˜æ–¹ä¸´æ—¶å…¬é’¥
    // æ‰§è¡Œæ–¹ç”¨è‡ªå·±ç§é’¥ + ä¸´æ—¶å…¬é’¥ = å…±äº«å¯†é’¥ â†’ è§£å¯†payload
}

// éšç§ä»»åŠ¡æµç¨‹
// 1. Aå‘å¸ƒä»»åŠ¡æ—¶ï¼Œåªå…¬å¼€ç±»å‹å’Œå¥–åŠ±
// 2. Bè¡¨ç¤ºæ„Ÿå…´è¶£ï¼Œå‘é€è‡ªå·±çš„å…¬é’¥
// 3. Aç”¨ECDHç”Ÿæˆå…±äº«å¯†é’¥ï¼ŒåŠ å¯†ä»»åŠ¡è¯¦æƒ…å‘ç»™B
// 4. Bè§£å¯†åå†³å®šæ˜¯å¦æ¥å—
// 5. å…¨ç¨‹ç¬¬ä¸‰æ–¹æ— æ³•çœ‹åˆ°ä»»åŠ¡å†…å®¹
```

### P-06: æµé‡æ»¥ç”¨é˜²æŠ¤

```go
// BandwidthController å¸¦å®½æ§åˆ¶å™¨
type BandwidthController struct {
    // æ¯èŠ‚ç‚¹é™åˆ¶
    MaxBytesPerHour    int64             // æ¯å°æ—¶æœ€å¤§ä¼ è¾“é‡
    MaxConcurrentTransfers int           // æœ€å¤§å¹¶å‘ä¼ è¾“æ•°
    
    // å£°èª‰åŠ æˆ
    ReputationBonus    float64           // é«˜å£°èª‰èŠ‚ç‚¹å¸¦å®½åŠ æˆ
    
    // å½“å‰çŠ¶æ€
    usage              map[string]*UsageRecord
}

type UsageRecord struct {
    NodeID          string
    BytesSent       int64
    BytesReceived   int64
    ActiveTransfers int
    LastReset       time.Time
}

// æµé‡è®¡è´¹ï¼ˆå£°èª‰æ¶ˆè€—ï¼‰
const (
    ReputationPerGB = 0.1   // æ¯ä¼ è¾“1GBæ¶ˆè€—0.1å£°èª‰
    FreeQuotaGB     = 1.0   // æ¯å¤©å…è´¹1GB
)
```

### P-09: é˜²æ­¢å‘å¸ƒåæ¶ˆå¤±

```go
// ä»»åŠ¡ä¿è¯é‡‘æœºåˆ¶
type TaskGuarantee struct {
    // å§”æ‰˜æ–¹å¿…é¡»é”å®šæŠ¼é‡‘
    RequesterDeposit float64   // è‡³å°‘ = Reward * 1.2
    
    // è¶…æ—¶è§„åˆ™
    ResponseTimeout  time.Duration  // å§”æ‰˜æ–¹å¿…é¡»åœ¨æ­¤æ—¶é—´å†…å“åº”äº¤ä»˜
    
    // è¿çº¦å¤„ç†
    DefaultPenalty   float64        // è¿çº¦ç½šé‡‘
}

// å¦‚æœAå‘å¸ƒä»»åŠ¡åæ¶ˆå¤±:
// 1. Bå®Œæˆå¹¶æäº¤äº¤ä»˜è¯æ˜
// 2. Aåœ¨ResponseTimeoutå†…æœªå“åº”
// 3. ç³»ç»Ÿè‡ªåŠ¨å°†Açš„æŠ¼é‡‘è½¬ç»™B
// 4. Aå£°èª‰æ‰£åˆ†
```

---

## ğŸ”„ æ–‡ä»¶ä¼ è¾“åè®®

### åˆ†ç‰‡ä¼ è¾“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ–‡ä»¶åˆ†ç‰‡ä¼ è¾“åè®®                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚   å‘é€æ–¹(A)                              æ¥æ”¶æ–¹(B)             â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  1. TransferRequest                  â”‚                  â”‚
â”‚      â”‚  (æ–‡ä»¶å…ƒä¿¡æ¯+å“ˆå¸Œ+æŠ¼é‡‘)              â”‚                  â”‚
â”‚      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  2. TransferAccept                   â”‚                  â”‚
â”‚      â”‚  (åŒæ„+æŠ¼é‡‘)                         â”‚                  â”‚
â”‚      â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  3. Chunk[0] + Hash                  â”‚                  â”‚
â”‚      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚                  â”‚
â”‚      â”‚                                      â”‚ éªŒè¯Hash        â”‚
â”‚      â”‚  4. ChunkAck[0]                      â”‚                  â”‚
â”‚      â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  ... (é‡å¤3-4ç›´åˆ°å®Œæˆ) ...           â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  5. TransferComplete                 â”‚                  â”‚
â”‚      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚                  â”‚
â”‚      â”‚                                      â”‚ éªŒè¯å®Œæ•´æ–‡ä»¶Hash â”‚
â”‚      â”‚  6. TransferConfirm                  â”‚                  â”‚
â”‚      â”‚  (åŒæ–¹ç­¾åçš„ä¼ è¾“è¯æ˜)                â”‚                  â”‚
â”‚      â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â”‚      â”‚  7. æŠ¼é‡‘é‡Šæ”¾                         â”‚                  â”‚
â”‚      â”‚                                      â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–­ç‚¹ç»­ä¼ æ”¯æŒ

```go
// TransferCheckpoint ä¼ è¾“æ£€æŸ¥ç‚¹
type TransferCheckpoint struct {
    TransferID      string
    LastChunkIndex  int
    ReceivedChunks  []bool    // ä½å›¾ï¼šå“ªäº›åˆ†ç‰‡å·²æ”¶åˆ°
    PartialHash     string    // å·²æ”¶åˆ°éƒ¨åˆ†çš„å“ˆå¸Œ
    SavedAt         int64
}

// æ¢å¤ä¼ è¾“
func (t *TransferManager) ResumeTransfer(checkpoint *TransferCheckpoint) error {
    // 1. æ‰¾åˆ°ä¸Šæ¬¡ä¸­æ–­ä½ç½®
    // 2. è¯·æ±‚ç¼ºå¤±çš„åˆ†ç‰‡
    // 3. ç»§ç»­ä¼ è¾“
}
```

---

## ğŸ“ æ–‡ä»¶è§„åˆ’

```
internal/
â”œâ”€â”€ task/                         # æ–°å¢: å§”æ‰˜ä»»åŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ task.go                  # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ task_test.go
â”‚   â”œâ”€â”€ filter.go                # ä»»åŠ¡è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ limiter.go               # é€Ÿç‡é™åˆ¶å™¨
â”‚   â””â”€â”€ types.go                 # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ transfer/                     # æ–°å¢: æ–‡ä»¶ä¼ è¾“æ¨¡å—
â”‚   â”œâ”€â”€ transfer.go              # ä¼ è¾“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ transfer_test.go
â”‚   â”œâ”€â”€ chunk.go                 # åˆ†ç‰‡å¤„ç†
â”‚   â”œâ”€â”€ bandwidth.go             # å¸¦å®½æ§åˆ¶
â”‚   â””â”€â”€ checkpoint.go            # æ–­ç‚¹ç»­ä¼ 
â”‚
â”œâ”€â”€ escrow/                       # æ–°å¢: æŠ¼é‡‘æ‰˜ç®¡æ¨¡å—
â”‚   â”œâ”€â”€ escrow.go                # æ‰˜ç®¡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ escrow_test.go
â”‚   â””â”€â”€ release.go               # é‡Šæ”¾è§„åˆ™
â”‚
â”œâ”€â”€ dispute/                      # æ–°å¢: äº‰è®®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ dispute.go               # äº‰è®®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ dispute_test.go
â”‚   â”œâ”€â”€ arbitration.go           # ä»²è£é€»è¾‘
â”‚   â””â”€â”€ evidence.go              # è¯æ®æ”¶é›†
â”‚
â””â”€â”€ privacy/                      # æ–°å¢: éšç§ä¿æŠ¤æ¨¡å—
    â”œâ”€â”€ encryption.go            # ç«¯åˆ°ç«¯åŠ å¯†
    â”œâ”€â”€ encryption_test.go
    â””â”€â”€ keyexchange.go           # å¯†é’¥äº¤æ¢
```

---

## ğŸ”§ å®ç°æ­¥éª¤

### Phase 1: åŸºç¡€ä»»åŠ¡ç³»ç»Ÿ (Day 1-2)

- ä»»åŠ¡ç±»å‹å®šä¹‰ä¸çŠ¶æ€æœº
- ä»»åŠ¡å‘å¸ƒã€æ¥å—ã€å®Œæˆæµç¨‹
- é€Ÿç‡é™åˆ¶ä¸åŸºç¡€è¿‡æ»¤

### Phase 2: æŠ¼é‡‘ä¸ç»“ç®— (Day 2-3)

- æŠ¼é‡‘é”å®šä¸é‡Šæ”¾
- æ‰¿è¯º-æ­ç¤ºåè®®
- äº¤ä»˜è¯æ˜ç”Ÿæˆ

### Phase 3: æ–‡ä»¶ä¼ è¾“ (Day 3-5)

- åˆ†ç‰‡ä¼ è¾“åè®®
- å¸¦å®½æ§åˆ¶
- æ–­ç‚¹ç»­ä¼ 

### Phase 4: éšç§ä¸å®‰å…¨ (Day 5-6)

- ç«¯åˆ°ç«¯åŠ å¯†
- ä»»åŠ¡å†…å®¹ä¿æŠ¤
- å¯†é’¥äº¤æ¢

### Phase 5: äº‰è®®å¤„ç† (Day 6-7)

- è‡ªåŠ¨ä»²è£è§„åˆ™
- å§”å‘˜ä¼šä»‹å…¥
- è¯æ®é“¾ä¿å­˜

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

| æµ‹è¯•é¡¹ | è¦†ç›–å†…å®¹ |
|--------|---------|
| ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ | çŠ¶æ€æµè½¬ã€è¶…æ—¶å¤„ç† |
| é€Ÿç‡é™åˆ¶ | é…é¢è®¡ç®—ã€å†·å´æœºåˆ¶ |
| æ–‡ä»¶ä¼ è¾“ | åˆ†ç‰‡ã€å“ˆå¸ŒéªŒè¯ã€æ–­ç‚¹ç»­ä¼  |
| æŠ¼é‡‘ç³»ç»Ÿ | é”å®šã€é‡Šæ”¾ã€é€€æ¬¾ |
| éšç§ä¿æŠ¤ | åŠ å¯†è§£å¯†ã€å¯†é’¥äº¤æ¢ |

### é›†æˆæµ‹è¯•

```go
func TestTaskWorkflow(t *testing.T) {
    // 1. Aå‘å¸ƒä»»åŠ¡ï¼ˆé”å®šæŠ¼é‡‘ï¼‰
    // 2. Bæ¥å—ä»»åŠ¡ï¼ˆé”å®šæŠ¼é‡‘ï¼‰
    // 3. Bæ‰§è¡Œå¹¶æäº¤äº¤ä»˜è¯æ˜
    // 4. Aç¡®è®¤æ”¶åˆ°
    // 5. æŠ¼é‡‘é‡Šæ”¾ï¼Œå£°èª‰ç»“ç®—
}

func TestDisputeResolution(t *testing.T) {
    // 1. Aå‘å¸ƒä»»åŠ¡
    // 2. Bå®Œæˆä½†Aæ‹’ç»ç¡®è®¤
    // 3. Bå‘èµ·äº‰è®®
    // 4. æäº¤è¯æ®
    // 5. è‡ªåŠ¨/å§”å‘˜ä¼šä»²è£
    // 6. éªŒè¯ç»“æœ
}
```

---

## ğŸ“ éªŒæ”¶æ ‡å‡†

- [ ] ä»»åŠ¡å‘å¸ƒã€æ¥å—ã€å®Œæˆæµç¨‹æ­£å¸¸
- [ ] æŠ¼é‡‘æ­£ç¡®é”å®šå’Œé‡Šæ”¾
- [ ] æ–‡ä»¶åˆ†ç‰‡ä¼ è¾“æ— æ•°æ®ä¸¢å¤±
- [ ] æ–­ç‚¹ç»­ä¼ åŠŸèƒ½æ­£å¸¸
- [ ] ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤éšç§
- [ ] é€Ÿç‡é™åˆ¶æœ‰æ•ˆé˜²æ­¢æ»¥å‘
- [ ] äº‰è®®å¤„ç†æµç¨‹å®Œæ•´
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ“š å‚è€ƒ

- [Task 26 å…±è¯†æœºåˆ¶](task26å…±è¯†æœºåˆ¶.md) - äº‹ä»¶è´¦æœ¬ã€å§”å‘˜ä¼šå…±è¯†
- [Task 11 æ¿€åŠ±æœºåˆ¶](task11æ¿€åŠ±.md) - å£°èª‰å¥–æƒ©
- [Task 14 æ¶ˆæ¯ç­¾å](task14æ¶ˆæ¯ç­¾å.md) - Nonceé˜²é‡æ”¾
- [BitTorrent Protocol](https://www.bittorrent.org/beps/bep_0003.html) - åˆ†ç‰‡ä¼ è¾“å‚è€ƒ
- [IPFS](https://docs.ipfs.tech/) - å†…å®¹å¯»å€å­˜å‚¨