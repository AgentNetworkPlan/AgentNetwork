# 🗂 “轻量共识 + 传播声誉”设计方案

## 1️⃣ BT 网络的启示

BitTorrent 网络本身没有“全局账本”或共识机制，它做的是 **局部信誉和激励**：

1. **Tit-for-Tat（以牙还牙）机制**

   * 交换数据时，优先服务于贡献多的节点
   * 节点只看到自己和直接通信伙伴的行为

2. **局部统计**

   * 节点只维护自己和邻居的上传/下载速度、贡献量
   * 没有全网统一账本
   * 信用是**局部感知**，不是全网一致

3. **隐式激励**

   * 高贡献 → 获得更快下载或优先服务
   * 低贡献 → 限速、拒绝服务

> 核心思想：**信誉和奖励是局部、动态、可验证的，而不是全网一致的账本记录**

---

## 2️⃣ 声誉系统设计

你想要“声誉可以传播”，可以参考社交网络式的 **Web-of-Trust**：

### 2.1 节点声誉表示

* 每个节点有 **NodeID（SM2 公钥）**
* 节点维护本地 **信誉表**：

  ```json
  {
    "NodeID_A": 80,
    "NodeID_B": 50,
    "NodeID_C": 20
  }
  ```
* 信誉分值可量化贡献：

  * 完成任务 → 增加
  * 作假 / 失职 → 减少
  * 节点可设置最小信誉阈值才接受委托

### 2.2 声誉传播机制

* 节点与**可信节点**建立信任关系（线上确认或抵押）
* 当两个节点通信时：

  * **交换各自的信誉表**
  * 只采纳可信节点的推荐
* 声誉传播策略：

  * 权重叠加：来自可信节点的评价比陌生节点的评价更高
  * 信誉值衰减：传播越远，权重越低

### 2.3 声誉更新公式（示例）

假设节点 A 信任节点 B（权重 w_AB），B 给 C 的评价是 r_BC，则 A 对 C 的间接信誉可以计算：

```
r_AC_indirect = w_AB * r_BC
```

* A 自己对 C 的直接观察 r_AC_direct 与间接信誉结合：

```
r_AC = α * r_AC_direct + (1-α) * sum(r_AC_indirects)
```

* α ∈ [0,1] 调节直接经验和间接传播的权重
* 这种方式类似 **Web-of-Trust + 指数衰减**

---

## 3️⃣ 防滥用与 Sybil 攻击

* **节点必须绑定公钥**
* **可信关系建立**：

  * 线下或线上身份确认
  * 可附加抵押（信誉抵押，非货币）
* **传播信誉时仅采纳可信节点的推荐**
* **间接传播衰减** 防止远距离 Sybil 篡改

---

## 4️⃣ 节点本地维护 vs 全局

* **本地维护**：

  * 节点只维护与自己相关的直接和可信间接评价
  * 无需全网账本
* **动态更新**：

  * 每次通信 → 交换信誉表 → 更新本地数据
* **节点离线/上线**：

  * 离线不会破坏全网声誉
  * 上线后可以从可信节点同步更新

---

## 5️⃣ 工程实现建议

### 5.1 数据结构

```go
type Reputation struct {
    NodeID string
    Score  int
    LastUpdated time.Time
    Source map[string]float64 // 谁给的权重
}
type ReputationTable map[string]Reputation
```

### 5.2 更新流程

1. 完成任务 / 被观察到贡献 → 更新直接评分
2. 与可信节点通信 → 交换信誉表
3. 计算间接信誉 → 更新本地表
4. 使用信誉表作为：

   * 任务委托权重
   * Worker 选择优先级
   * 验证委员会选择依据

### 5.3 特点

* **无需全局账本**
* **动态、可传播**
* **激励局部良性行为**
* **容易扩展**：

  * 信誉衰减机制
  * 权重自适应调整
  * 与任务贡献量化结合

---

## 6️⃣ 总结

| 特性    | 说明                   |
| ----- | -------------------- |
| 不需要账本 | 全网不保存完整记录，本地维护即可     |
| 信誉传播  | 可信节点之间交换，间接传播，衰减处理   |
| 防滥用   | 信任建立 + 抵押 + 本地验证     |
| 激励机制  | 高信誉节点更易获得任务，低信誉节点被限制 |
| 可扩展   | 与贡献证明、任务完成量结合        |

> 核心思想：BT 网络的“Tit-for-Tat + 局部统计” + Web-of-Trust 的“可信传播”，无需全局账本，也能维护网络安全和贡献激励。

