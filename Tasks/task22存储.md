# ğŸ’¾ èŠ‚ç‚¹å­˜å‚¨è®¾è®¡æ–¹æ¡ˆ

## 1ï¸âƒ£ é…ç½®å­˜å‚¨ï¼ˆconfig.jsonï¼‰

### 1.1 å­˜å‚¨å†…å®¹

* èŠ‚ç‚¹èº«ä»½ï¼š

  * NodeID
  * SM2 å…¬é’¥/ç§é’¥è·¯å¾„
* ç½‘ç»œå‚æ•°ï¼š

  * ç›‘å¬ç«¯å£
  * å…¬ç½‘/å†…ç½‘æ ‡è¯†
  * è¶…çº§èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
* é‚»å±…å‚æ•°ï¼š

  * æœ€å¤§é‚»å±…æ•°
  * é‚»å±…åˆ·æ–°å‘¨æœŸ
* æ—¥å¿—é…ç½®ï¼š

  * æ—¥å¿—æ–‡ä»¶è·¯å¾„
  * æ—¥å¿—ç­‰çº§
* ä»»åŠ¡ä¸å£°èª‰å‚æ•°ï¼š

  * åˆå§‹å£°èª‰
  * å£°èª‰è¡°å‡å€¼
  * æŒ‡è´£è€å—å€¼
* èŠ‚ç‚¹å¯åŠ¨å‚æ•°ï¼š

  * æ˜¯å¦å¯ç”¨åå°æ¨¡å¼
  * HTTPæ¥å£ç«¯å£

### 1.2 ç¤ºä¾‹ config.json

```json
{
  "NodeID": "Node1",
  "SM2": {
    "PublicKeyPath": "./keys/node1_pub.pem",
    "PrivateKeyPath": "./keys/node1_priv.pem"
  },
  "Network": {
    "Port": 18345,
    "NAT": true,
    "SuperNodes": ["NodeX", "NodeY"]
  },
  "Neighbors": {
    "MaxNeighbors": 8,
    "RefreshInterval": 3600
  },
  "Logging": {
    "LogFile": "./logs/node1.log",
    "Level": "INFO"
  },
  "Reputation": {
    "Initial": 10,
    "DecayPerDay": 1,
    "AccuseTolerance": 5
  },
  "NodeOptions": {
    "BackgroundMode": true,
    "HTTPPort": 8080
  }
}
```

---

## 2ï¸âƒ£ ç¨‹åºå­˜å‚¨ï¼ˆè¿è¡Œæ•°æ®ï¼‰

### 2.1 å­˜å‚¨å†…å®¹

| æ•°æ®ç±»å‹ | å­˜å‚¨å†…å®¹                | æ–‡ä»¶/ç›®å½•ç¤ºä¾‹                |
| ---- | ------------------- | ---------------------- |
| é‚»å±…åˆ—è¡¨ | å½“å‰åœ¨çº¿é‚»å±…IDã€IPã€ç«¯å£ã€å£°èª‰   | `data/neighbors.json`  |
| ä»»åŠ¡çŠ¶æ€ | å·²åˆ›å»º/å·²åˆ†é…/å·²å®Œæˆ/éªŒè¯ç»“æœ    | `data/tasks.json`      |
| å£°èª‰æ•°æ® | èŠ‚ç‚¹å£°èª‰å€¼ã€æ¥æºä»»åŠ¡IDã€é‚»å±…ä¼ æ’­ä¿¡æ¯ | `data/reputation.json` |
| æŒ‡è´£æ¶ˆæ¯ | æŒ‡è´£æ¥æºã€è¢«æŒ‡è´£èŠ‚ç‚¹ã€é‚»å±…åˆ†æç»“æœ   | `data/accuse.json`     |
| æ¶ˆæ¯å­˜å‚¨ | æ”¶å‘æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç±»ä¼¼é‚®ç®±         | `data/messages/`       |
| æ—¥å¿—æ–‡ä»¶ | èŠ‚ç‚¹è¡Œä¸ºã€ç½‘ç»œçŠ¶æ€ã€ä»»åŠ¡æ‰§è¡Œæƒ…å†µ    | `logs/node1.log`       |

### 2.2 æ•°æ®æŒä¹…åŒ–è®¾è®¡

1. **JSON/æ–‡ä»¶å­˜å‚¨**ï¼ˆç®€å•å®ç°ï¼‰

   * å°å‹æµ‹è¯•ç½‘ç»œå¯ç›´æ¥ç”¨ JSON æ–‡ä»¶å­˜å‚¨
   * æ˜“äºè°ƒè¯•å’Œè¿ç§»

2. **è½»é‡çº§æ•°æ®åº“**ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

   * SQLite / LevelDB / RocksDB
   * ä¼˜ç‚¹ï¼š

     * é«˜æ€§èƒ½è¯»å†™
     * åŸå­æ“ä½œï¼Œé¿å…æ•°æ®æŸå
     * æ”¯æŒäº‹åŠ¡ï¼Œæ–¹ä¾¿æ¢å¤

3. **æ¶ˆæ¯é˜Ÿåˆ—/ç¼“å­˜**

   * å¯¹äºé«˜é¢‘ä»»åŠ¡ã€æ¶ˆæ¯æˆ–å£°èª‰æ›´æ–°ï¼Œå¯ä½¿ç”¨å†…å­˜ç¼“å­˜ï¼ˆå¦‚ Python dict æˆ– Go mapï¼‰
   * å®šæœŸåŒæ­¥åˆ°ç£ç›˜æ•°æ®åº“

---

## 3ï¸âƒ£ æ•°æ®ç»“æ„ç¤ºä¾‹

### 3.1 é‚»å±…åˆ—è¡¨

```json
[
  {"NodeID":"Node2","IP":"192.168.0.2","Port":18345,"Reputation":12},
  {"NodeID":"Node3","IP":"192.168.0.3","Port":18345,"Reputation":9}
]
```

### 3.2 ä»»åŠ¡çŠ¶æ€

```json
[
  {"TaskID":"task_001","TargetNode":"Node2","Status":"Completed","ResultDigest":"abc123","Verifier":"Node1"},
  {"TaskID":"task_002","TargetNode":"Node3","Status":"Assigned","ResultDigest":"","Verifier":""}
]
```

### 3.3 å£°èª‰æ•°æ®

```json
[
  {"NodeID":"Node2","Delta":3,"SourceTask":"task_001","Originator":"Node1","Timestamp":1670004000},
  {"NodeID":"Node3","Delta":-2,"SourceAccuse":"accuse_001","Originator":"Node5","Timestamp":1670005000}
]
```

### 3.4 æŒ‡è´£æ•°æ®

```json
[
  {"AccuserID":"Node3","AccusedID":"Node4","Reason":"æœªå®Œæˆä»»åŠ¡","Timestamp":1670005000,"ProcessedBy":["Node5","Node6"]}
]
```

### 3.5 æ¶ˆæ¯å­˜å‚¨ï¼ˆç±»ä¼¼é‚®ç®±ï¼‰

```
data/messages/Node5/
   msg_001.json
   msg_002.json
```

æ¯æ¡æ¶ˆæ¯åŒ…å«ï¼š

```json
{
  "MessageID":"msg_001",
  "Sender":"Node2",
  "Receiver":"Node5",
  "Content":"Hello Node5",
  "Timestamp":1670006000,
  "Signature":"SM2ç­¾å",
  "Status":"Unread"
}
```

---

## 4ï¸âƒ£ æ–‡ä»¶/ç›®å½•ç»“æ„å»ºè®®

```
node/
 â”œâ”€ config.json                 # èŠ‚ç‚¹é…ç½®
 â”œâ”€ keys/
 â”‚   â”œâ”€ node_pub.pem
 â”‚   â””â”€ node_priv.pem
 â”œâ”€ data/
 â”‚   â”œâ”€ neighbors.json
 â”‚   â”œâ”€ tasks.json
 â”‚   â”œâ”€ reputation.json
 â”‚   â”œâ”€ accuse.json
 â”‚   â””â”€ messages/
 â”‚       â”œâ”€ msg_001.json
 â”‚       â””â”€ ...
 â”œâ”€ logs/
 â”‚   â””â”€ node1.log
 â””â”€ node_main.py                 # èŠ‚ç‚¹ä¸»ç¨‹åº
```

---

## 5ï¸âƒ£ å¼€å‘å»ºè®®

1. **é…ç½®ä¸æ•°æ®åˆ†ç¦»**ï¼š

   * `config.json` åªè¯»ï¼Œè¿è¡Œæ—¶ä¸ä¿®æ”¹
   * è¿è¡Œæ•°æ®å­˜å‚¨åœ¨ `data/`ï¼Œæ”¯æŒçƒ­æ›´æ–°å’ŒæŒä¹…åŒ–

2. **å®šæœŸåŒæ­¥**ï¼š

   * å†…å­˜æ•°æ® â†’ æ•°æ®åº“æˆ–æ–‡ä»¶ï¼Œæ¯éš” 1~5 ç§’
   * èŠ‚ç‚¹å¼‚å¸¸é€€å‡º â†’ æ•°æ®å¯æ¢å¤

3. **å®‰å…¨æ€§**ï¼š

   * æ•°æ®æ–‡ä»¶æƒé™è®¾ç½®ï¼Œé¿å…ç§é’¥æ³„éœ²
   * æ¶ˆæ¯/ä»»åŠ¡æ•°æ®éƒ½åº” SM2 ç­¾åéªŒè¯

4. **å¯æ‰©å±•æ€§**ï¼š

   * æ—¥åå¯å¢åŠ æ—¥å¿—è½®è½¬ã€å†å²ä»»åŠ¡å½’æ¡£
   * å¯æ¢ SQLite/LevelDB æ›¿ä»£ JSON å­˜å‚¨

