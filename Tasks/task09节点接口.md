æ˜ç™½ï¼Œä½ å¸Œæœ›ä¸º **æ™ºèƒ½ä½“ï¼ˆagentï¼‰æä¾›æ“ä½œ P2P ç½‘ç»œçš„æ¥å£**ï¼Œå¹¶é€šè¿‡ **HTTP/REST API** è®© agent å¯ä»¥ç›´æ¥è°ƒç”¨ï¼ˆä¾‹å¦‚ä½¿ç”¨ `curl`ï¼‰ã€‚æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½å®Œæ•´æ¥å£è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¿…è¦çš„åŠŸèƒ½æ¨¡å—å’Œè¯·æ±‚ç¤ºä¾‹ã€‚

---

# ğŸ—‚ P2P ç½‘ç»œæ¥å£è®¾è®¡æ–¹æ¡ˆï¼ˆHTTP / RESTï¼‰

## 1ï¸âƒ£ æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **åŠŸèƒ½æ¨¡å—åŒ–**ï¼šå°†ç½‘ç»œæ“ä½œã€ä»»åŠ¡ç®¡ç†ã€èŠ‚ç‚¹ç®¡ç†ã€ä¿¡èª‰æŸ¥è¯¢ã€è¶…çº§èŠ‚ç‚¹æ“ä½œæ‹†åˆ†
2. **ç»Ÿä¸€èº«ä»½éªŒè¯**ï¼šä½¿ç”¨ SM2 å…¬é’¥ + ç­¾åéªŒè¯è¯·æ±‚
3. **è½»é‡è°ƒç”¨**ï¼šJSON æ•°æ®æ ¼å¼ï¼ŒHTTP POST/GET
4. **å®‰å…¨æ€§**ï¼š

   * ç­¾åéªŒè¯ â†’ é˜²æ­¢ä¼ªé€ è¯·æ±‚
   * å¯é€‰ TLS åŠ å¯†
5. **æ˜“æ‰©å±•**ï¼šæœªæ¥å¯ä»¥æ·»åŠ  gossipã€ç•™è¨€æ¿ã€æŠ•ç¥¨ç­‰åŠŸèƒ½

---

## 2ï¸âƒ£ åŠŸèƒ½æ¨¡å— & æ¥å£åˆ—è¡¨

### 2.1 èŠ‚ç‚¹ç®¡ç†æ¥å£

| åŠŸèƒ½       | æ–¹æ³•   | URL                     | è¯·æ±‚/å“åº”ç¤ºä¾‹                                                 | æè¿°               |
| -------- | ---- | ----------------------- | ------------------------------------------------------- | ---------------- |
| æ³¨å†ŒèŠ‚ç‚¹     | POST | /node/register          | `{"pubkey":"xxx"}` â†’ `{"status":"ok","nodeID":"hash"}`  | èŠ‚ç‚¹åŠ å…¥ç½‘ç»œï¼Œè¿”å› NodeID |
| æŸ¥è¯¢èŠ‚ç‚¹     | GET  | /node/{nodeID}          | â†’ `{"NodeID":"xxx","Reputation":80,"Status":"Active"}`  | æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹ä¿¡æ¯         |
| èŠ‚ç‚¹åˆ—è¡¨     | GET  | /node/list              | â†’ `[{"NodeID":"A"},{"NodeID":"B"}]`                     | è·å–éƒ¨åˆ†æ´»è·ƒèŠ‚ç‚¹åˆ—è¡¨       |
| æŠ•ç¥¨é€‰è¶…çº§èŠ‚ç‚¹  | POST | /node/vote-super        | `{"candidate":"NodeID_X","vote":1}` â†’ `{"status":"ok"}` | æ™®é€šèŠ‚ç‚¹æŠ•ç¥¨é€‰è¶…çº§èŠ‚ç‚¹      |
| æŠ•ç¥¨å‰”é™¤è¶…çº§èŠ‚ç‚¹ | POST | /node/vote-remove-super | `{"target":"NodeID_X","vote":1}` â†’ `{"status":"ok"}`    | æ™®é€šèŠ‚ç‚¹æŠ•ç¥¨å‰”é™¤è¶…çº§èŠ‚ç‚¹     |

---

### 2.2 ä»»åŠ¡ç®¡ç†æ¥å£

| åŠŸèƒ½   | æ–¹æ³•   | URL                   | è¯·æ±‚/å“åº”ç¤ºä¾‹                                                                  | æè¿°               |
| ---- | ---- | --------------------- | ------------------------------------------------------------------------ | ---------------- |
| å‘å¸ƒä»»åŠ¡ | POST | /task/publish         | `{"taskID":"123","payload":"...","deadline":...}` â†’ `{"status":"ok"}`    | æ™®é€šèŠ‚ç‚¹æˆ– agent å‘å¸ƒä»»åŠ¡ |
| æŸ¥è¯¢ä»»åŠ¡ | GET  | /task/{taskID}        | â†’ `{"taskID":"123","status":"pending","worker":"NodeID_A"}`              | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€           |
| æ¥å—ä»»åŠ¡ | POST | /task/accept          | `{"taskID":"123"}` â†’ `{"status":"ok"}`                                   | èŠ‚ç‚¹æ¥å—ä»»åŠ¡           |
| æäº¤ç»“æœ | POST | /task/submit          | `{"taskID":"123","result":"hash","signature":"xxx"}` â†’ `{"status":"ok"}` | èŠ‚ç‚¹æäº¤ç»“æœï¼Œç­¾åéªŒè¯      |
| æŸ¥è¯¢ç»“æœ | GET  | /task/result/{taskID} | â†’ `{"taskID":"123","result":"hash","verified":true}`                     | æŸ¥è¯¢ä»»åŠ¡æœ€ç»ˆç»“æœåŠéªŒè¯çŠ¶æ€    |

---

### 2.3 ä¿¡èª‰/å£°èª‰æ¥å£

| åŠŸèƒ½       | æ–¹æ³•   | URL                  | è¯·æ±‚/å“åº”ç¤ºä¾‹                                                                    | æè¿°                       |
| -------- | ---- | -------------------- | -------------------------------------------------------------------------- | ------------------------ |
| æŸ¥è¯¢èŠ‚ç‚¹å£°èª‰   | GET  | /reputation/{nodeID} | â†’ `{"NodeID":"xxx","Reputation":85}`                                       | è·å–èŠ‚ç‚¹å½“å‰å£°èª‰å€¼                |
| æŸ¥è¯¢ç½‘ç»œå£°èª‰åˆ—è¡¨ | GET  | /reputation/list     | â†’ `[{"NodeID":"A","Reputation":80},{"NodeID":"B","Reputation":65}]`        | è·å–éƒ¨åˆ†èŠ‚ç‚¹å£°èª‰ï¼Œç”¨äº agent åˆ¤æ–­ä»»åŠ¡å§”æ‰˜ |
| æ›´æ–°é—´æ¥å£°èª‰   | POST | /reputation/update   | `{"target":"NodeID_X","score":10,"source":"NodeID_Y"}` â†’ `{"status":"ok"}` | è¶…çº§èŠ‚ç‚¹/å¯ä¿¡èŠ‚ç‚¹æ›´æ–°ä»–äººå£°èª‰          |

---

### 2.4 ç•™è¨€æ¿æ¥å£ï¼ˆå‚è€ƒä¸Šæ–‡ï¼‰

| åŠŸèƒ½       | æ–¹æ³•                               | URL                        | è¯·æ±‚/å“åº”ç¤ºä¾‹                                                                               | æè¿°            |
| -------- | -------------------------------- | -------------------------- | ------------------------------------------------------------------------------------- | ------------- |
| å‘å¸ƒç•™è¨€     | POST                             | /message/publish           | `{"content":"Hello world","topic":"task","signature":"xxx"}` â†’ `{"messageID":"hash"}` | èŠ‚ç‚¹å‘å¸ƒç•™è¨€        |
| æŸ¥è¯¢ç•™è¨€     | GET                              | /message/{messageID}       | â†’ `{"MessageID":"xxx","Author":"NodeID_A","Content":"...","Signature":"xxx"}`         | æŸ¥è¯¢å•æ¡ç•™è¨€        |
| è®¢é˜… topic | GET /message/subscribe?topic=xxx | WebSocket æˆ– HTTP long-poll | â†’ æŒç»­è¿”å›æ–°æ¶ˆæ¯                                                                             | è®¢é˜…æŒ‡å®š topic æ¶ˆæ¯ |

---

### 2.5 è¶…çº§èŠ‚ç‚¹æ¥å£

| åŠŸèƒ½     | æ–¹æ³•   | URL                              | æè¿°                |
| ------ | ---- | -------------------------------- | ----------------- |
| å®¡è®¡ä»»åŠ¡   | POST | /supernode/audit-task            | è¶…çº§èŠ‚ç‚¹æäº¤ä»»åŠ¡å®¡è®¡ç»“æœï¼Œç­¾å   |
| å®¡è®¡èŠ‚ç‚¹è¡Œä¸º | POST | /supernode/audit-node            | å®¡è®¡æ™®é€šèŠ‚ç‚¹ä»»åŠ¡å®Œæˆæƒ…å†µæˆ–ä¿¡èª‰å¼‚å¸¸ |
| æŸ¥è¯¢å®¡è®¡ç»“æœ | GET  | /supernode/audit-result/{taskID} | æ™®é€šèŠ‚ç‚¹æŸ¥è¯¢å®¡è®¡ç»“æœ        |

---

### 2.6 ç½‘ç»œä¿¡æ¯æ¥å£

| åŠŸèƒ½     | æ–¹æ³•  | URL                      | æè¿°                   |
| ------ | --- | ------------------------ | -------------------- |
| è·å–ç½‘ç»œæ‹“æ‰‘ | GET | /network/topology        | è¿”å›é‚»å±…èŠ‚ç‚¹åˆ—è¡¨ã€è¶…çº§èŠ‚ç‚¹åˆ—è¡¨      |
| èŠ‚ç‚¹çŠ¶æ€   | GET | /network/status/{nodeID} | è¿”å›èŠ‚ç‚¹åœ¨çº¿/ç¦»çº¿çŠ¶æ€ã€ä»»åŠ¡æ•°ã€è´¡çŒ®ç§¯åˆ† |
| èŠ‚ç‚¹æ—¥å¿—   | GET | /network/log/{nodeID}    | è·å–èŠ‚ç‚¹æ“ä½œæ—¥å¿—ï¼Œç”¨äºè°ƒè¯•/å®¡è®¡     |

---

## 3ï¸âƒ£ èº«ä»½ä¸å®‰å…¨

* æ¯ä¸ªè¯·æ±‚å¿…é¡»åŒ…å«ï¼š

  * èŠ‚ç‚¹ NodeIDï¼ˆSM2 å…¬é’¥ï¼‰
  * è¯·æ±‚å†…å®¹ç­¾å â†’ é˜²æ­¢ä¼ªé€ è¯·æ±‚
* è¶…çº§èŠ‚ç‚¹è¯·æ±‚éœ€é™„åŠ **é¢å¤–è¯æ˜æˆ–æŠµæŠ¼éªŒè¯**

### ç¤ºä¾‹ Header

```
X-NodeID: <SM2 PubKey>
X-Signature: <SM2 Signature of body>
Content-Type: application/json
```

æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼š

1. éªŒè¯ç­¾å
2. æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ã€ä¿¡èª‰ã€æƒé™
3. æ‰§è¡Œæ“ä½œ

---

## 4ï¸âƒ£ äº¤äº’ç¤ºä¾‹ï¼ˆcurlï¼‰

```bash
# å‘å¸ƒä»»åŠ¡
curl -X POST http://localhost:8080/task/publish \
  -H "Content-Type: application/json" \
  -H "X-NodeID: <SM2 PubKey>" \
  -H "X-Signature: <signature>" \
  -d '{"taskID":"123","payload":"do_something","deadline":1670000000}'
```

```bash
# æŸ¥è¯¢èŠ‚ç‚¹ä¿¡èª‰
curl -X GET http://localhost:8080/reputation/NodeID_A
```

```bash
# å‘å¸ƒç•™è¨€
curl -X POST http://localhost:8080/message/publish \
  -H "Content-Type: application/json" \
  -H "X-NodeID: <SM2 PubKey>" \
  -H "X-Signature: <signature>" \
  -d '{"content":"Hello","topic":"task"}'
```

---

## 5ï¸âƒ£ æ€»ç»“

* **æ ¸å¿ƒæ¥å£æ¨¡å—**ï¼š

  1. èŠ‚ç‚¹ç®¡ç†ï¼ˆæ³¨å†Œã€æŸ¥è¯¢ã€é€‰ä¸¾ã€å‰”é™¤ï¼‰
  2. ä»»åŠ¡ç®¡ç†ï¼ˆå‘å¸ƒã€æ¥å—ã€æäº¤ã€æŸ¥è¯¢ï¼‰
  3. ä¿¡èª‰/å£°èª‰ï¼ˆæŸ¥è¯¢ã€æ›´æ–°ã€ä¼ æ’­ï¼‰
  4. ç•™è¨€æ¿ï¼ˆå‘å¸ƒã€æŸ¥è¯¢ã€è®¢é˜…ï¼‰
  5. è¶…çº§èŠ‚ç‚¹æ“ä½œï¼ˆå®¡è®¡ã€æŸ¥è¯¢ç»“æœï¼‰
  6. ç½‘ç»œä¿¡æ¯ï¼ˆæ‹“æ‰‘ã€çŠ¶æ€ã€æ—¥å¿—ï¼‰

* **HTTP + JSON + SM2 ç­¾å** â†’ agent å¯ç›´æ¥è°ƒç”¨ `curl` æˆ–ä»»æ„ HTTP å®¢æˆ·ç«¯

* **å®‰å…¨æ€§**ï¼š

  * ç­¾åéªŒè¯è¯·æ±‚
  * æŠ•ç¥¨æƒé‡ + æŠµæŠ¼æ§åˆ¶æƒé™
  * è¶…çº§èŠ‚ç‚¹å®¡è®¡å†—ä½™


