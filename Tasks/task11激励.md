# 🗂 节点声誉激励与传播设计方案

## 1️⃣ 核心目标

1. 节点完成任务 → 获得贡献声誉
2. 声誉通过邻居网络传播 → 激励节点行为
3. 新加入节点需**邀请机制** → 避免 Sybil 攻击
4. 声誉传播**衰减 + 耐受值** → 防止滥发
5. 节点邻居由全网共识产生 → 保证网络拓扑合理

---

## 2️⃣ 声誉生成机制

### 2.1 完成任务奖励声誉

```text
ΔReputation(node) = BaseScore * TaskWeight
```

* `BaseScore`：任务完成基本分（例如 10）
* `TaskWeight`：任务重要性、难度系数
* 节点完成任务 → 立即获得 ΔReputation

### 2.2 邻居传播机制

* 每个节点将收到的声誉传播给 **邻居节点**
* 声誉衰减公式：

[
R_{new} = R_{received} \times \text{DecayFactor}
]

* `DecayFactor` ∈ (0,1)，例如 0.7 → 每传播一次衰减 30%
* 传播深度受 **耐受值** 控制

---

## 3️⃣ 邻居耐受值控制

* 每个节点对每个声誉来源 **有耐受值** `Tolerance`
* 当累计声誉超过耐受值 → 不再接受或传播声誉

```text
if ReputationReceivedFromSource > Tolerance:
    discard propagation
```

* **重置机制**：

  * 每个周期（如一天/一周）重置耐受值
  * 避免长期封锁声誉增长

---

## 4️⃣ 邀请机制（新节点加入）

1. **邀请函生成**：

   * 已有节点使用自己的 SM2 私钥签发新节点的邀请函
   * 包含：

     * 新节点公钥
     * 邀请节点 ID
     * 签名

2. **验证**：

   * 新节点提交邀请函加入网络
   * 邀请节点签名验证 → 确认身份

3. **效果**：

   * 防止大量伪造节点涌入
   * 保证每个新节点至少有一个可信来源

---

## 5️⃣ 新节点邻居选择

* 新节点加入后，根据 **全网共识** 或 **本地视图**选择邻居

* 选择原则：

  * 邻居信誉高 → 可靠传播链
  * 网络拓扑均衡 → 避免孤岛
  * 邻居数量有限 → 限制网络复杂度

* 示例算法：

  1. 获取活跃节点列表（例如超级节点推荐或 DHT 查询）
  2. 按信誉值排序，选择前 N 个节点作为邻居
  3. 记录邻居列表 → 后续声誉传播使用

---

## 6️⃣ 声誉传播流程

```
任务完成 → 直接贡献声誉
    │
    ▼
邻居接收声誉
    │
    ├─> 检查耐受值
    │       └─> 超过耐受值 → 不传播
    │
    └─> 衰减后传播给自己的邻居
             │
             └─> 循环传播直到衰减到0或达到耐受值
```

* **传播是局部化 + 衰减 + 限制耐受**
* 防止恶意节点刷声誉

---

## 7️⃣ 声誉激励公式示例

假设：

* `R0` = 初始任务贡献声誉
* `DecayFactor` = 0.7
* `Tolerance` = 50
* `Neighbors` = N 个

传播到第 k 层的声誉：

[
R_k = R_0 \times DecayFactor^k
]

* 若累计从该来源的 R > Tolerance → 阻止继续传播

---

## 8️⃣ 工程接口设计（Agent 调用）

### 8.1 完成任务奖励

```http
POST /reputation/award
Body:
{
  "NodeID": "NodeID_X",
  "TaskID": "Task123",
  "Score": 10
}
```

### 8.2 邻居传播

```http
POST /reputation/propagate
Body:
{
  "SourceNodeID": "NodeID_X",
  "Reputation": 10,
  "DecayFactor": 0.7
}
```

### 8.3 邀请机制

```http
POST /node/invite
Body:
{
  "NewNodePubKey": "SM2_pub_new",
  "Signature": "<InviteSignature>"
}
```

### 8.4 邻居查询

```http
GET /node/neighbors?nodeID=NodeID_X
Response:
[
  {"NodeID":"Neighbor1","Reputation":80},
  {"NodeID":"Neighbor2","Reputation":75}
]
```

---

## 9️⃣ 总结设计特点

| 特点     | 描述                                   |
| ------ | ------------------------------------ |
| 完成任务奖励 | 节点完成任务获得直接声誉                         |
| 邻居传播   | 声誉在邻居间传播，带衰减                         |
| 邻居耐受值  | 限制过量声誉传播，防止滥发                        |
| 邀请机制   | 新节点需现有节点签名邀请函加入                      |
| 邻居选择   | 新节点根据全网共识选择邻居，保证网络可靠                 |
| 激励闭环   | 完成任务 → 增加声誉 → 邻居传播 → 增强网络健康 → 激励更多节点 |

---

这个方案可以 **形成一个健康的去中心化声誉网络**，同时 **防止 Sybil 攻击和滥发声誉**，保证任务完成者得到应有的奖励。

---

关键点：

* 任务完成 → 声誉生成
* 邻居传播与衰减
* 耐受值限制
* 新节点加入与邻居选择
