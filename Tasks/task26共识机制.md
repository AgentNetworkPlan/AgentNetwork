# Task 26: å…±è¯†æœºåˆ¶ä¸æ‹…ä¿å…¥ç½‘

> **çŠ¶æ€**: ğŸ“‹ è®¾è®¡ä¸­  
> **ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒåŠŸèƒ½)  
> **é¢„è®¡å·¥ä½œé‡**: 3-5 å¤©  
> **ä¾èµ–**: Task 02 èŠ‚ç‚¹è®¤è¯, Task 07 æŠ•ç¥¨æœºåˆ¶, Task 15 åˆ›ä¸–èŠ‚ç‚¹

---

## ğŸ¤” è®¾è®¡æ€è€ƒï¼šæˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Ÿ

### PTB vs AgentNetwork å¯¹æ¯”åˆ†æ

| ç»´åº¦ | PTB (æ–‡ä»¶åˆ†äº«ç½‘ç»œ) | AgentNetwork (Agentåä½œç½‘ç»œ) |
|------|-------------------|----------------------------|
| æ ¸å¿ƒèµ„äº§ | ç§¯åˆ†ï¼ˆé«˜é¢‘äº¤æ˜“ï¼‰ | å£°èª‰ï¼ˆä½é¢‘å˜æ›´ï¼‰ |
| äº¤æ˜“ç±»å‹ | ä¸Šä¼ /ä¸‹è½½æµé‡ç»“ç®— | ä»»åŠ¡åä½œã€ä¿¡æ¯äº¤æ¢ |
| é˜²æŠ¤é‡ç‚¹ | åŒèŠ±ã€å¸è¡€ | å£°èª‰æ¬ºè¯ˆã€æ¶æ„èŠ‚ç‚¹ |
| ä¸€è‡´æ€§è¦æ±‚ | å¼ºä¸€è‡´ï¼ˆè´¦æœ¬ï¼‰ | æœ€ç»ˆä¸€è‡´ï¼ˆå¯å®¹å¿çŸ­æœŸå·®å¼‚ï¼‰ |

### å…³é”®å†³ç­–ï¼šä¸éœ€è¦å®Œæ•´åŒºå—é“¾

**åŸå› åˆ†æï¼š**

1. âŒ **æ²¡æœ‰ç§¯åˆ†è½¬è´¦** - å£°èª‰ä¸èƒ½ç›´æ¥åœ¨èŠ‚ç‚¹é—´è½¬ç§»
2. âŒ **æ²¡æœ‰åŒèŠ±é—®é¢˜** - å£°èª‰ä¸æ˜¯è´§å¸ï¼Œæ— éœ€é˜²æ­¢é‡å¤æ”¯ä»˜
3. âŒ **äº¤æ˜“é¢‘ç‡ä½** - äº‹ä»¶çº§åˆ«ï¼ˆå…¥ç½‘/è¿è§„ï¼‰ï¼Œéäº¤æ˜“çº§åˆ«
4. âŒ **è¿‡åº¦è®¾è®¡** - åŒºå—é“¾å…±è¯†å¼€é”€å¤§ï¼Œä½†å¯¹æœ¬é¡¹ç›®æ”¶ç›Šæœ‰é™

### æˆ‘ä»¬çœŸæ­£éœ€è¦çš„

| éœ€è¦ | ä¸éœ€è¦ |
|------|--------|
| äº‹ä»¶å¯è¿½æº¯ | åŒºå—é“¾å®Œæ•´å…±è¯† |
| æ‹…ä¿å…³ç³»è®°å½• | POW æŒ–çŸ¿ |
| å£°èª‰å˜æ›´æ—¥å¿— | ç§¯åˆ†è½¬è´¦ç³»ç»Ÿ |
| å…±è¯†å†³è®®å­˜æ¡£ | å¤æ‚çš„æ™ºèƒ½åˆçº¦ |
| å¤šèŠ‚ç‚¹å¤åˆ¶ | ä¸¥æ ¼çš„å…¨å±€ä¸€è‡´æ€§ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡ï¼šè½»é‡çº§äº‹ä»¶è´¦æœ¬

### æ ¸å¿ƒæ¦‚å¿µï¼šEvent Sourcing (äº‹ä»¶æº¯æº)

```
ä¸å­˜å‚¨"å½“å‰çŠ¶æ€"ï¼Œè€Œæ˜¯å­˜å‚¨"æ‰€æœ‰äº‹ä»¶"
å½“å‰çŠ¶æ€ = é‡æ”¾æ‰€æœ‰äº‹ä»¶

ä¼˜ç‚¹ï¼š
- å®Œæ•´å®¡è®¡è¿½è¸ª
- å¯å›æº¯ä»»æ„æ—¶åˆ»çŠ¶æ€
- å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å¤åˆ¶
- æ¯”åŒºå—é“¾è½»é‡
```

### äº‹ä»¶æ—¥å¿—ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Event Log (äº‹ä»¶æ—¥å¿—)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 001 | Type: NODE_JOIN                                  â”‚
â”‚ Data: {node_id: "A", sponsor: "Genesis", init_rep: 1}       â”‚
â”‚ Timestamp: 1707000000 | Signature: <sponsor_sig>            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 002 | Type: NODE_JOIN                                  â”‚
â”‚ Data: {node_id: "B", sponsor: "A", init_rep: 1}             â”‚
â”‚ Timestamp: 1707000100 | Signature: <A_sig>                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 003 | Type: REPUTATION_CHANGE                          â”‚
â”‚ Data: {node_id: "A", delta: +5, source: "task_complete"}    â”‚
â”‚ Timestamp: 1707000200 | Signature: <supernode_sig>          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 004 | Type: CONSENSUS_DECISION                         â”‚
â”‚ Data: {proposal: "kick_X", result: "passed", votes: [...]}  â”‚
â”‚ Timestamp: 1707000300 | Signatures: [<N1>,<N2>,<N3>]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 005 | Type: VIOLATION                                  â”‚
â”‚ Data: {node_id: "B", type: "spam", penalty: -10}            â”‚
â”‚ Timestamp: 1707000400 | Signature: <auditor_sig>            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq: 006 | Type: LIABILITY_SETTLE                           â”‚
â”‚ Data: {sponsor: "A", for_node: "B", penalty: -5}            â”‚
â”‚ Timestamp: 1707000401 | Signature: <system_sig>             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸åŒºå—é“¾çš„å…³é”®åŒºåˆ«

| ç‰¹æ€§ | åŒºå—é“¾ | äº‹ä»¶è´¦æœ¬ (æœ¬é¡¹ç›®) |
|------|--------|------------------|
| å…±è¯† | å…¨ç½‘å…±è¯†æ¯ä¸ªåŒºå— | åªå¯¹å…³é”®å†³ç­–å…±è¯† |
| å­˜å‚¨ | é“¾å¼åŒºå— | é¡ºåºäº‹ä»¶æ—¥å¿— |
| éªŒè¯ | æ¯ä¸ªèŠ‚ç‚¹éªŒè¯å…¨éƒ¨ | æŒ‰éœ€éªŒè¯ç›¸å…³äº‹ä»¶ |
| ä¸€è‡´æ€§ | å¼ºä¸€è‡´ | æœ€ç»ˆä¸€è‡´ |
| å¤æ‚åº¦ | é«˜ | ä¸­ç­‰ |

---

## âš ï¸ å…³é”®é—®é¢˜æ·±å…¥æ€è€ƒ

### é—®é¢˜1ï¼šéœ€è¦å…¨ç½‘å…±è¯†å—ï¼Ÿ

**ç­”æ¡ˆï¼šä¸éœ€è¦å…¨ç½‘å…±è¯†ï¼Œä½†éœ€è¦å…¨ç½‘çŸ¥æ™“**

```
âŒ é”™è¯¯æ€è·¯ï¼šæ¯æ¬¡å…¥ç½‘éƒ½è¦1000ä¸ªèŠ‚ç‚¹æŠ•ç¥¨åŒæ„
âœ… æ­£ç¡®æ€è·¯ï¼šå§”å‘˜ä¼šå†³ç­– + Gossipä¼ æ’­ + æœ¬åœ°éªŒè¯
```

**BT/DHT ç½‘ç»œçš„å¯ç¤ºï¼š**

| å¯¹æ¯” | åŒºå—é“¾å…¨ç½‘å…±è¯† | BT/DHT ç½‘ç»œ | AgentNetwork (æ¨è) |
|------|--------------|-------------|---------------------|
| ä¸€è‡´æ€§ | å¼ºä¸€è‡´ | æœ€ç»ˆä¸€è‡´ | æœ€ç»ˆä¸€è‡´ |
| å»¶è¿Ÿ | ç§’~åˆ†é’Ÿ | æ¯«ç§’~ç§’ | ç§’çº§ |
| æ¶ˆæ¯å¤æ‚åº¦ | O(nÂ²) | O(log n) | O(k) + Gossip |
| å†³ç­–èŠ‚ç‚¹ | å…¨ç½‘ | æ— ä¸­å¿ƒ | å§”å‘˜ä¼š(kä¸ª) |

**æ¨èæ–¹æ¡ˆï¼šä¸¤å±‚æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±‚ï¼šå§”å‘˜ä¼šå…±è¯†ï¼ˆå¿«é€Ÿå†³ç­–ï¼‰                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ C1  â”‚ â”‚ C2  â”‚ â”‚ C3  â”‚ â”‚ C4  â”‚ â”‚ C5  â”‚   5-7ä¸ªèŠ‚ç‚¹       â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜   å»¶è¿Ÿ < 500ms    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                     â”‚ å¤šç­¾åç»“æœ                            â”‚
â”‚                     â–¼                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç¬¬äºŒå±‚ï¼šGossip ä¼ æ’­ï¼ˆå…¨ç½‘åŒæ­¥ï¼‰                              â”‚
â”‚                                                             â”‚
â”‚     N1 â”€â”€â†’ N2 â”€â”€â†’ N5                                       â”‚
â”‚      â†“      â†“      â†“       ä½¿ç”¨ libp2p GossipSub           â”‚
â”‚     N3 â”€â”€â†’ N4 â”€â”€â†’ N6       å»¶è¿Ÿ 1-3ç§’ å…¨ç½‘                  â”‚
â”‚      â†“      â†“      â†“       æ— éœ€ç­‰å¾…ç¡®è®¤                     â”‚
â”‚     ...    ...    ...                                      â”‚
â”‚                                                             â”‚
â”‚  æ¯ä¸ªèŠ‚ç‚¹æ”¶åˆ°åï¼šéªŒè¯å¤šç­¾å â†’ æ›´æ–°æœ¬åœ°çŠ¶æ€                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯å®ç°ï¼š**

```go
// ä½¿ç”¨ libp2p çš„ GossipSub åè®®
// å·²åœ¨ Task 01 P2Pç½‘ç»œ ä¸­é›†æˆ

// èŠ‚ç‚¹å…¥ç½‘å¹¿æ’­
type JoinAnnouncement struct {
    Event           *Event      // å…¥ç½‘äº‹ä»¶
    CommitteeVotes  []Vote      // å§”å‘˜ä¼šæŠ•ç¥¨ï¼ˆå¤šç­¾åï¼‰
    Timestamp       int64
}

// æ”¶åˆ°å¹¿æ’­å
func (n *Node) OnJoinAnnouncement(ann *JoinAnnouncement) error {
    // 1. éªŒè¯å§”å‘˜ä¼šå¤šç­¾åï¼ˆâ‰¥2/3ï¼‰
    if !VerifyMultiSig(ann.CommitteeVotes, ann.Event) {
        return ErrInvalidSignature
    }
    // 2. æ›´æ–°æœ¬åœ°çŠ¶æ€
    n.ledger.AppendEvent(ann.Event)
    // 3. ä¸éœ€è¦å›å¤ï¼ŒGossipä¼šç»§ç»­ä¼ æ’­
    return nil
}
```

---

### é—®é¢˜2ï¼šå¦‚ä½•é˜²æ­¢æ‹…ä¿æ¬ºè¯ˆï¼Ÿ

**æ”»å‡»åœºæ™¯åˆ†æï¼š**

| æ”»å‡»æ–¹å¼ | æè¿° | é˜²æŠ¤æªæ–½ |
|---------|------|---------|
| è™šå‡æ‹…ä¿ | å£°ç§°æ‹…ä¿ä½†ä¸é”å®šå£°èª‰ | å¤šç­¾åé”å®š |
| å§”å‘˜ä¼šä¸²é€š | å¤šä¸ªå§”å‘˜ä¼ªé€ ç»“æœ | éšæœºé€‰æ‹© + è½®æ¢ |
| å•ç‚¹ä¼ªé€  | å•ä¸ªèŠ‚ç‚¹ç¯¡æ”¹æ•°æ® | äº‹ä»¶é“¾å“ˆå¸ŒéªŒè¯ |

**è§£å†³æ–¹æ¡ˆï¼šåŸå­æ€§å¤šç­¾å**

```
å…³é”®æ´å¯Ÿï¼šæ‹…ä¿å¿…é¡»æ˜¯åŸå­æ“ä½œï¼Œä¸èƒ½åªæœ‰æ‹…ä¿äººç­¾å

æ‹…ä¿ç”Ÿæ•ˆçš„å¿…è¦æ¡ä»¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‹…ä¿ä¹¦ = æ‹…ä¿äººç­¾å + â‰¥2ä¸ªå§”å‘˜ä¼šæˆå‘˜ç­¾å                     â”‚
â”‚                                                             â”‚
â”‚  â‘  æ‹…ä¿äººç­¾åï¼š                                              â”‚
â”‚     - æ˜ç¡®åŒæ„æ‹…ä¿                                           â”‚
â”‚     - åŒ…å«å½“å‰å£°èª‰å¿«ç…§å“ˆå¸Œï¼ˆé˜²æ­¢å£°ç§°å£°èª‰ä¸è¶³ï¼‰                 â”‚
â”‚                                                             â”‚
â”‚  â‘¡ å§”å‘˜ä¼šéªŒè¯ç­¾åï¼š                                          â”‚
â”‚     - éªŒè¯æ‹…ä¿äººå£°èª‰è¶³å¤Ÿ                                     â”‚
â”‚     - ç­¾åè¡¨ç¤º"æˆ‘ç¡®è®¤æ‹…ä¿äººæœ‰è¶³å¤Ÿå£°èª‰"                        â”‚
â”‚     - è‡³å°‘ 2 ä¸ªå§”å‘˜ä¼šæˆå‘˜ï¼ˆé˜²æ­¢å•ç‚¹ä¼ªé€ ï¼‰                     â”‚
â”‚                                                             â”‚
â”‚  ç¼ºä»»ä½•ä¸€ä¸ªç­¾å â†’ æ‹…ä¿æ— æ•ˆ â†’ å…¥ç½‘è¢«æ‹’                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®ç»“æ„ï¼š**

```go
// æ‹…ä¿ä¹¦ï¼ˆåŸå­æ€§å¤šç­¾åï¼‰
type AtomicGuarantee struct {
    // æ‹…ä¿å†…å®¹
    SponsorID       string    
    NewNodeID       string    
    GuaranteeAmount float64   
    
    // çŠ¶æ€è¯æ˜ï¼ˆé˜²æ­¢è°æŠ¥ï¼‰
    SponsorReputation     float64  // æ‹…ä¿äººå½“å‰å£°èª‰
    StateSnapshotHash     string   // å½“å‰çŠ¶æ€å¿«ç…§å“ˆå¸Œ
    
    // å¤šæ–¹ç­¾å
    SponsorSignature      string   // æ‹…ä¿äººç­¾å
    CommitteeSignatures   []CommitteeSig // å§”å‘˜ä¼šç­¾åï¼ˆâ‰¥2ï¼‰
    
    CreatedAt       int64
    Nonce           string   // é˜²é‡æ”¾
}

type CommitteeSig struct {
    MemberID    string  // å§”å‘˜ä¼šæˆå‘˜ID
    Signature   string  // ç­¾å
    VerifiedAt  int64   // éªŒè¯æ—¶é—´
}

// éªŒè¯æ‹…ä¿ä¹¦
func ValidateGuarantee(g *AtomicGuarantee, committee []string) error {
    // 1. éªŒè¯æ‹…ä¿äººç­¾å
    if !VerifySponsorSig(g) {
        return ErrInvalidSponsorSig
    }
    
    // 2. éªŒè¯å§”å‘˜ä¼šç­¾åæ•°é‡
    validSigs := CountValidCommitteeSigs(g, committee)
    if validSigs < 2 {
        return ErrInsufficientCommitteeSigs
    }
    
    // 3. éªŒè¯çŠ¶æ€å¿«ç…§ï¼ˆé˜²æ­¢å£°ç§°å£°èª‰ä¸è¶³ï¼‰
    if !VerifyStateSnapshot(g.StateSnapshotHash) {
        return ErrInvalidStateSnapshot
    }
    
    return nil
}
```

**é˜²æ­¢å§”å‘˜ä¼šä¸²é€šï¼š**

```go
// éšæœº + è½®æ¢æœºåˆ¶
type CommitteeRotation struct {
    // æ¯ N ä¸ªäº‹ä»¶è½®æ¢ä¸€æ¬¡å§”å‘˜ä¼š
    RotationInterval   int     // å¦‚ï¼šæ¯100ä¸ªäº‹ä»¶
    
    // ä»é«˜å£°èª‰èŠ‚ç‚¹ä¸­éšæœºé€‰æ‹©
    SelectionPool      []string // å£°èª‰ > é˜ˆå€¼çš„èŠ‚ç‚¹
    CurrentCommittee   []string // å½“å‰å§”å‘˜ä¼š
    
    // ä½¿ç”¨äº‹ä»¶é“¾å“ˆå¸Œä½œä¸ºéšæœºç§å­ï¼ˆä¸å¯é¢„æµ‹ï¼‰
    RandomSeed         string   // = Hash(LastEventHash + BlockHeight)
}

// å§”å‘˜ä¼šé€‰æ‹©ç®—æ³•
func SelectCommittee(pool []string, seed string, size int) []string {
    // 1. ç”¨å“ˆå¸Œä½œä¸ºéšæœºæ•°ç§å­ï¼ˆç¡®å®šæ€§ä½†ä¸å¯é¢„æµ‹ï¼‰
    rng := NewDeterministicRNG(seed)
    
    // 2. æŒ‰å£°èª‰æƒé‡éšæœºé€‰æ‹©
    selected := WeightedRandomSelect(pool, size, rng)
    
    return selected
}
```

---

### é—®é¢˜3ï¼šé«˜æ•ˆå…±è¯†çš„è§£å†³æ–¹æ¡ˆ

**ä¸ºä»€ä¹ˆä¼ ç»Ÿå…±è¯†æ…¢ï¼Ÿ**

| ç®—æ³• | æ¶ˆæ¯å¤æ‚åº¦ | å»¶è¿Ÿ | é—®é¢˜ |
|------|-----------|------|------|
| PBFT | O(nÂ²) | é«˜ | å…¨ç½‘å¹¿æ’­ |
| Raft | O(n) | ä¸­ | Leaderç“¶é¢ˆ |
| PoW | O(n) | æé«˜ | 10åˆ†é’Ÿå‡ºå— |

**AgentNetwork çš„é€‰æ‹©ï¼šå§”æ‰˜+èšåˆ**

```
æ ¸å¿ƒæ€è·¯ï¼š
1. åªæœ‰å§”å‘˜ä¼šï¼ˆ5-7èŠ‚ç‚¹ï¼‰å‚ä¸å…±è¯† â†’ O(kÂ²) å…¶ä¸­ k<<n
2. æ™®é€šèŠ‚ç‚¹åªéªŒè¯ç­¾åï¼Œä¸å‚ä¸å…±è¯†
3. ä½¿ç”¨ç­¾åèšåˆå‡å°‘ä¼ è¾“é‡
```

**ç®€åŒ– PBFT æµç¨‹ï¼ˆé’ˆå¯¹å°å§”å‘˜ä¼šä¼˜åŒ–ï¼‰ï¼š**

```
ä¼ ç»Ÿ PBFT (nèŠ‚ç‚¹):
  Pre-prepare â†’ Prepare (næ¡) â†’ Commit (næ¡) â†’ Reply
  æ¶ˆæ¯æ•°: O(nÂ²)

ç®€åŒ–ç‰ˆ (k=5å§”å‘˜ä¼š):
  Request â†’ å§”å‘˜ä¼šæŠ•ç¥¨ (5æ¡) â†’ èšåˆç­¾å â†’ å¹¿æ’­ç»“æœ
  æ¶ˆæ¯æ•°: O(k) + Gossip
  
å»¶è¿Ÿåˆ†æï¼š
  å§”å‘˜ä¼šå…±è¯†: ~200ms (å±€åŸŸç½‘) / ~500ms (å¹¿åŸŸç½‘)
  Gossipä¼ æ’­: ~1-3s (1000èŠ‚ç‚¹ç½‘ç»œ)
  æ€»å»¶è¿Ÿ: < 5ç§’
```

**ä»£ç å®ç°ï¼š**

```go
// ç®€åŒ–å…±è¯†ï¼ˆéå®Œæ•´PBFTï¼Œé’ˆå¯¹å°å§”å‘˜ä¼šä¼˜åŒ–ï¼‰
type SimpleConsensus struct {
    committee   []string              // å§”å‘˜ä¼šæˆå‘˜
    threshold   int                   // é€šè¿‡é˜ˆå€¼ï¼ˆå¦‚5ä¸­çš„4ï¼‰
    timeout     time.Duration         // è¶…æ—¶æ—¶é—´ï¼ˆå¦‚3ç§’ï¼‰
}

// å‘èµ·å…±è¯†
func (sc *SimpleConsensus) Propose(event *Event) (*ConsensusResult, error) {
    // 1. å¹¿æ’­ç»™æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜
    votes := make(chan *Vote, len(sc.committee))
    for _, member := range sc.committee {
        go sc.requestVote(member, event, votes)
    }
    
    // 2. æ”¶é›†æŠ•ç¥¨ï¼ˆå¸¦è¶…æ—¶ï¼‰
    collected := sc.collectVotes(votes, sc.timeout)
    
    // 3. ç»Ÿè®¡ç»“æœ
    agrees := CountAgrees(collected)
    if agrees >= sc.threshold {
        // èšåˆç­¾å
        aggregatedSig := AggregateSignatures(collected)
        return &ConsensusResult{
            Passed: true,
            Votes:  collected,
            AggregatedSignature: aggregatedSig,
        }, nil
    }
    
    return &ConsensusResult{Passed: false}, ErrConsensusFailed
}
```

---

### å€Ÿé‰´å…¶ä»–é¡¹ç›®

| é¡¹ç›® | å…±è¯†æ–¹å¼ | å¯å€Ÿé‰´ç‚¹ |
|------|---------|---------|
| **IPFS/libp2p** | æ— å…±è¯†ï¼ŒDHT+Gossip | GossipSub ä¼ æ’­åè®® |
| **Tendermint** | å¿«é€ŸBFT (~1s) | å§”æ‰˜å…±è¯†æµç¨‹ |
| **Holochain** | æ— å…¨ç½‘å…±è¯†ï¼Œæºé“¾+DHT | Agentè‡ªä¸»ï¼ŒæŒ‰éœ€éªŒè¯ |
| **Matrix** | äº‹ä»¶DAGï¼Œæœ€ç»ˆä¸€è‡´ | äº‹ä»¶å›¾ç»“æ„ |
| **Stellar** | è”é‚¦æ‹œå åº­åè®® | ä¿¡ä»»åˆ‡ç‰‡æ¦‚å¿µ |

**æœ€é€‚åˆ AgentNetwork çš„æ–¹æ¡ˆï¼š**

```
Holochain æ¨¡å¼ + Tendermint å§”å‘˜ä¼š

1. æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤è‡ªå·±çš„äº‹ä»¶é“¾ï¼ˆHolochainæ€è·¯ï¼‰
2. å…³é”®äº‹ä»¶ï¼ˆå…¥ç½‘/è¿è§„ï¼‰éœ€è¦å§”å‘˜ä¼šèƒŒä¹¦
3. ä½¿ç”¨ libp2p GossipSub ä¼ æ’­
4. å…¶ä»–èŠ‚ç‚¹é€šè¿‡ç­¾åéªŒè¯ï¼Œæ— éœ€é‡æ–°å…±è¯†
```

---

### æœ€ç»ˆè®¾è®¡ï¼šæ··åˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AgentNetwork å…±è¯†æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ äº‹ä»¶åˆ†ç±»                                                   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ å…³é”®äº‹ä»¶     â”‚    â”‚ æ™®é€šäº‹ä»¶     â”‚    â”‚ æœ¬åœ°äº‹ä»¶     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ (éœ€å§”å‘˜ä¼š)   â”‚    â”‚ (éœ€ç­¾å)     â”‚    â”‚ (æ— éœ€å…±è¯†)   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚           â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚    â”‚å…¥ç½‘/é€€ç½‘ â”‚        â”‚å£°èª‰å˜æ›´  â”‚        â”‚å¿ƒè·³/çŠ¶æ€â”‚     â”‚ â”‚
â”‚  â”‚    â”‚æ‹…ä¿/è¿è§„ â”‚        â”‚ä»»åŠ¡å®Œæˆ  â”‚        â”‚é‚»å±…å‘ç° â”‚     â”‚ â”‚
â”‚  â”‚    â”‚å‰”é™¤æŠ•ç¥¨  â”‚        â”‚å®¡è®¡ç»“æœ  â”‚        â”‚æœ¬åœ°æ—¥å¿— â”‚     â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚           â”‚ â”‚
â”‚  â”‚         â–¼                  â–¼                  â–¼           â”‚ â”‚
â”‚  â”‚   å§”å‘˜ä¼šå…±è¯†           å•ç­¾åéªŒè¯          ä¸åŒæ­¥         â”‚ â”‚
â”‚  â”‚   (5èŠ‚ç‚¹å¤šç­¾)         (æ¥æºå¯ä¿¡å³å¯)       (æœ¬åœ°å­˜å‚¨)      â”‚ â”‚
â”‚  â”‚         â”‚                  â”‚                              â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚  â”‚                  â”‚                                        â”‚ â”‚
â”‚  â”‚                  â–¼                                        â”‚ â”‚
â”‚  â”‚           GossipSub å¹¿æ’­                                  â”‚ â”‚
â”‚  â”‚           (libp2p å†…ç½®)                                   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•ˆç‡å¯¹æ¯”ï¼š**

| åœºæ™¯ | ä¼ ç»Ÿå…¨ç½‘å…±è¯† | æœ¬è®¾è®¡ |
|------|------------|--------|
| 1000èŠ‚ç‚¹å…¥ç½‘ | 1Mæ¡æ¶ˆæ¯ | 5æ¡+Gossip |
| å»¶è¿Ÿ | 10ç§’+ | <3ç§’ |
| ååé‡ | ~10 tx/s | ~100 äº‹ä»¶/s |

### å‚è€ƒé¡¹ç›®: PrivateTrackerBlockchain

ä» [PrivateTrackerBlockchain](https://github.com/hyfree/PrivateTrackerBlockchain) é¡¹ç›®å€Ÿé‰´çš„æ ¸å¿ƒæ€æƒ³ï¼š

| ç‰¹æ€§ | PTB å®ç° | AgentNetwork å€Ÿé‰´æ–¹æ¡ˆ |
|------|---------|----------------------|
| **èŠ‚ç‚¹å…¥ç½‘** | éœ€è¦ç°æœ‰èŠ‚ç‚¹é‚€è¯·+æ‹…ä¿ | è€èŠ‚ç‚¹ç­¾åæ‹…ä¿ + å§”å‘˜ä¼šå…±è¯†éªŒè¯ |
| **æ‹…ä¿æƒ©ç½š** | è¢«é‚€è¯·è€…è¿è§„ï¼Œé‚€è¯·è€…æ‰¿æ‹…50%ç½šæ¬¾ | å¼•å…¥æ‹…ä¿è¿å¸¦è´£ä»»æœºåˆ¶ |
| **å…±è¯†æœºåˆ¶** | PBFT å…±è¯† | ç®€åŒ– PBFTï¼Œ2/3 å¤šæ•°åŒæ„ |
| **èŠ‚ç‚¹å‰”é™¤** | å…±è¯†æœºåˆ¶æŠ•ç¥¨å‰”é™¤ | åŸºäºç°æœ‰æŠ•ç¥¨ç³»ç»Ÿæ‰©å±• |
| **ç§¯åˆ†æŠµæŠ¼** | äº¤æ˜“éœ€è¦åŒæ–¹æŠµæŠ¼ | å…¥ç½‘éœ€è¦æ‹…ä¿æŠµæŠ¼ |

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **æ‹…ä¿å…¥ç½‘**: æ–°èŠ‚ç‚¹åŠ å…¥éœ€è¦è€èŠ‚ç‚¹æ‹…ä¿ï¼ˆç­¾åï¼‰
2. **å…±è¯†éªŒè¯**: å…¥ç½‘ç”³è¯·éœ€è¦å§”å‘˜ä¼šå¤šæ•°åŒæ„
3. **è¿å¸¦è´£ä»»**: æ–°èŠ‚ç‚¹è¿è§„ï¼Œæ‹…ä¿äººæ‰¿æ‹…éƒ¨åˆ†æƒ©ç½š
4. **ä¿¡ä»»ä¼ é€’**: å»ºç«‹å¯è¿½æº¯çš„ä¿¡ä»»é“¾æ¡

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. æ‹…ä¿å…¥ç½‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1.ç”³è¯·æ‹…ä¿     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°èŠ‚ç‚¹      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  æ‹…ä¿èŠ‚ç‚¹    â”‚
â”‚  (NewNode)   â”‚                  â”‚  (Sponsor)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â”‚                                 â”‚ 2.ç­¾å‘æ‹…ä¿ä¹¦
       â”‚                                 â–¼
       â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                          â”‚  æ‹…ä¿ä¹¦      â”‚
       â”‚                          â”‚ (Guarantee) â”‚
       â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â”‚ 3.æäº¤å…¥ç½‘ç”³è¯·(å«æ‹…ä¿ä¹¦)         â”‚
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å§”å‘˜ä¼šéªŒè¯ (Committee)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ N1  â”‚  â”‚ N2  â”‚  â”‚ N3  â”‚  â”‚ N4  â”‚  â”‚ N5  â”‚ â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜ â”‚
â”‚     â”‚        â”‚        â”‚        â”‚        â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    å…±è¯†æŠ•ç¥¨                    â”‚
â”‚              (2/3 å¤šæ•°åŒæ„)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ 4.å…±è¯†ç»“æœ
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ åŒæ„ / æ‹’ç»   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®ç»“æ„è®¾è®¡

#### 2.1 æ‹…ä¿ä¹¦ (Guarantee)

```go
// Guarantee æ‹…ä¿ä¹¦
type Guarantee struct {
    // åŸºæœ¬ä¿¡æ¯
    ID              string    `json:"id"`               // æ‹…ä¿ä¹¦ID
    Version         int       `json:"version"`          // ç‰ˆæœ¬å·
    
    // æ‹…ä¿äººä¿¡æ¯
    SponsorID       string    `json:"sponsor_id"`       // æ‹…ä¿äººèŠ‚ç‚¹ID
    SponsorPubKey   string    `json:"sponsor_pubkey"`   // æ‹…ä¿äººå…¬é’¥
    SponsorReputation float64 `json:"sponsor_reputation"` // æ‹…ä¿äººå½“å‰å£°èª‰
    
    // è¢«æ‹…ä¿äººä¿¡æ¯
    NewNodeID       string    `json:"new_node_id"`      // æ–°èŠ‚ç‚¹ID
    NewNodePubKey   string    `json:"new_node_pubkey"`  // æ–°èŠ‚ç‚¹å…¬é’¥
    
    // æ‹…ä¿æ¡æ¬¾
    InitialReputation float64 `json:"initial_reputation"` // åˆå§‹å£°èª‰
    GuaranteeAmount   float64 `json:"guarantee_amount"`   // æ‹…ä¿é‡‘é¢
    LiabilityRatio    float64 `json:"liability_ratio"`    // è¿å¸¦è´£ä»»æ¯”ä¾‹ (0-1)
    ValidUntil        int64   `json:"valid_until"`        // æ‹…ä¿æœ‰æ•ˆæœŸ
    
    // ç­¾å
    CreatedAt       int64     `json:"created_at"`       // åˆ›å»ºæ—¶é—´æˆ³
    Signature       string    `json:"signature"`        // æ‹…ä¿äººSM2ç­¾å
    Nonce           string    `json:"nonce"`            // é˜²é‡æ”¾Nonce
}
```

#### 2.2 å…¥ç½‘ç”³è¯· (JoinRequest)

```go
// ConsensusJoinRequest å…±è¯†å…¥ç½‘ç”³è¯·
type ConsensusJoinRequest struct {
    // ç”³è¯·ä¿¡æ¯
    RequestID       string      `json:"request_id"`
    NewNodeID       string      `json:"new_node_id"`
    NewNodePubKey   string      `json:"new_node_pubkey"`
    
    // æ‹…ä¿ä¹¦
    Guarantee       *Guarantee  `json:"guarantee"`
    
    // ç”³è¯·å…ƒæ•°æ®
    RequestedAt     int64       `json:"requested_at"`
    Signature       string      `json:"signature"`      // æ–°èŠ‚ç‚¹ç­¾å
    Nonce           string      `json:"nonce"`
}
```

#### 2.3 å…±è¯†æŠ•ç¥¨ (ConsensusVote)

```go
// JoinConsensusVote å…¥ç½‘å…±è¯†æŠ•ç¥¨
type JoinConsensusVote struct {
    RequestID       string        `json:"request_id"`     // ç”³è¯·ID
    VoterID         string        `json:"voter_id"`       // æŠ•ç¥¨è€…ID
    Vote            bool          `json:"vote"`           // true=åŒæ„, false=æ‹’ç»
    Reason          string        `json:"reason"`         // æŠ•ç¥¨ç†ç”±
    Timestamp       int64         `json:"timestamp"`
    Signature       string        `json:"signature"`
}

// JoinConsensusResult å…±è¯†ç»“æœ
type JoinConsensusResult struct {
    RequestID       string        `json:"request_id"`
    TotalVoters     int           `json:"total_voters"`   // å‚ä¸æŠ•ç¥¨æ•°
    AgreeVotes      int           `json:"agree_votes"`    // åŒæ„ç¥¨æ•°
    DisagreeVotes   int           `json:"disagree_votes"` // åå¯¹ç¥¨æ•°
    Passed          bool          `json:"passed"`         // æ˜¯å¦é€šè¿‡
    Reason          string        `json:"reason"`         // ç»“æœè¯´æ˜
    FinalizedAt     int64         `json:"finalized_at"`   // ç¡®è®¤æ—¶é—´
    Signatures      []string      `json:"signatures"`     // å‚ä¸èŠ‚ç‚¹ç­¾å
}
```

### 3. å…±è¯†æœºåˆ¶è®¾è®¡

#### 3.1 ç®€åŒ– PBFT å…±è¯†

```
é˜¶æ®µ1: Pre-prepare (é¢„å‡†å¤‡)
  - ä¸»èŠ‚ç‚¹æ”¶åˆ°å…¥ç½‘ç”³è¯·
  - éªŒè¯æ‹…ä¿ä¹¦æœ‰æ•ˆæ€§
  - å¹¿æ’­ç»™æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜

é˜¶æ®µ2: Prepare (å‡†å¤‡)  
  - å„èŠ‚ç‚¹éªŒè¯ç”³è¯·
  - å¹¿æ’­ Prepare æ¶ˆæ¯
  - æ”¶é›† 2f+1 ä¸ª Prepare

é˜¶æ®µ3: Commit (æäº¤)
  - å¹¿æ’­ Commit æ¶ˆæ¯
  - æ”¶é›† 2f+1 ä¸ª Commit
  - æ‰§è¡Œå…¥ç½‘æ“ä½œ

å…¶ä¸­: n = å§”å‘˜ä¼šèŠ‚ç‚¹æ•°, f = æœ€å¤§å®¹é”™èŠ‚ç‚¹æ•° = (n-1)/3
å…±è¯†æ¡ä»¶: éœ€è¦ 2/3 ä»¥ä¸ŠèŠ‚ç‚¹åŒæ„
```

#### 3.2 å…±è¯†å‚æ•°

```go
const (
    // å…±è¯†å‚æ•°
    MinCommitteeSize      = 4      // æœ€å°å§”å‘˜ä¼šè§„æ¨¡
    ConsensusQuorum       = 0.67   // å…±è¯†æ³•å®šäººæ•° (2/3)
    ConsensusTTL          = 300    // å…±è¯†è¶…æ—¶æ—¶é—´(ç§’)
    MaxPendingRequests    = 100    // æœ€å¤§å¾…å¤„ç†ç”³è¯·æ•°
    
    // æ‹…ä¿å‚æ•°
    MinSponsorReputation  = 30.0   // æ‹…ä¿äººæœ€ä½å£°èª‰
    DefaultGuaranteeAmount= 10.0   // é»˜è®¤æ‹…ä¿é‡‘é¢
    DefaultLiabilityRatio = 0.5    // é»˜è®¤è¿å¸¦è´£ä»»æ¯”ä¾‹
    GuaranteeValidDays    = 90     // æ‹…ä¿æœ‰æ•ˆæœŸ(å¤©)
    MaxSponsoredNodes     = 5      // å•èŠ‚ç‚¹æœ€å¤§æ‹…ä¿æ•°
)
```

### 4. è¿å¸¦è´£ä»»æœºåˆ¶

```go
// LiabilityRecord è¿å¸¦è´£ä»»è®°å½•
type LiabilityRecord struct {
    ID              string    `json:"id"`
    SponsorID       string    `json:"sponsor_id"`       // æ‹…ä¿äºº
    NewNodeID       string    `json:"new_node_id"`      // è¢«æ‹…ä¿äºº
    GuaranteeID     string    `json:"guarantee_id"`     // æ‹…ä¿ä¹¦ID
    
    // è¿è§„ä¿¡æ¯
    ViolationType   string    `json:"violation_type"`   // è¿è§„ç±»å‹
    OriginalPenalty float64   `json:"original_penalty"` // åŸå§‹ç½šæ¬¾
    SponsorPenalty  float64   `json:"sponsor_penalty"`  // æ‹…ä¿äººæ‰¿æ‹…
    
    // å¤„ç†çŠ¶æ€
    Status          string    `json:"status"`           // pending/settled
    SettledAt       int64     `json:"settled_at"`
}
```

**è¿å¸¦è´£ä»»è§„åˆ™**:

| è¿è§„ç±»å‹ | è¢«æ‹…ä¿äººæƒ©ç½š | æ‹…ä¿äººè¿å¸¦ | æ‹…ä¿æœ‰æ•ˆæœŸ |
|---------|------------|-----------|-----------|
| è½»å¾®è¿è§„ | å£°èª‰ -5    | å£°èª‰ -2   | 30å¤©å†…    |
| ä¸­åº¦è¿è§„ | å£°èª‰ -15   | å£°èª‰ -7   | 60å¤©å†…    |
| ä¸¥é‡è¿è§„ | è¢«å‰”é™¤     | å£°èª‰ -20  | 90å¤©å†…    |
| æ¶æ„è¡Œä¸º | è¢«å‰”é™¤     | è¢«å‰”é™¤    | æ°¸ä¹…      |

### 5. é˜²æ­¢æ»¥å‘é‚€è¯·

**é—®é¢˜ï¼šä¸€ä¸ªèŠ‚ç‚¹çŸ­æ—¶é—´å†…é‚€è¯·å¤§é‡èŠ‚ç‚¹æ€ä¹ˆåŠï¼Ÿ**

```go
// é‚€è¯·é™åˆ¶æœºåˆ¶
type InvitationLimiter struct {
    // é€Ÿç‡é™åˆ¶
    MaxInvitesPerDay      int       // æ¯å¤©æœ€å¤šé‚€è¯·æ•°ï¼ˆå¦‚ï¼š2ä¸ªï¼‰
    MaxActiveGuarantees   int       // åŒæ—¶æœ‰æ•ˆæ‹…ä¿æ•°ï¼ˆå¦‚ï¼š5ä¸ªï¼‰
    
    // å£°èª‰é—¨æ§›
    MinReputationToInvite float64   // é‚€è¯·æ‰€éœ€æœ€ä½å£°èª‰ï¼ˆå¦‚ï¼š30ï¼‰
    ReputationCostPerInvite float64 // æ¯æ¬¡é‚€è¯·æ¶ˆè€—å£°èª‰ï¼ˆå¦‚ï¼š5ï¼ŒæˆåŠŸåè¿”è¿˜ï¼‰
    
    // å†·å´æœŸ
    CooldownAfterViolation time.Duration // è¢«æ‹…ä¿äººè¿è§„åçš„é‚€è¯·å†·å´æœŸ
}

// æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘èµ·é‚€è¯·
func (il *InvitationLimiter) CanInvite(sponsorID string) error {
    // 1. æ£€æŸ¥å£°èª‰
    rep := GetReputation(sponsorID)
    if rep < il.MinReputationToInvite {
        return ErrInsufficientReputation
    }
    
    // 2. æ£€æŸ¥ä»Šæ—¥é‚€è¯·æ•°
    todayInvites := CountTodayInvites(sponsorID)
    if todayInvites >= il.MaxInvitesPerDay {
        return ErrDailyLimitExceeded
    }
    
    // 3. æ£€æŸ¥æ´»è·ƒæ‹…ä¿æ•°
    activeGuarantees := CountActiveGuarantees(sponsorID)
    if activeGuarantees >= il.MaxActiveGuarantees {
        return ErrTooManyActiveGuarantees
    }
    
    // 4. æ£€æŸ¥å†·å´æœŸ
    if IsInCooldown(sponsorID) {
        return ErrInCooldown
    }
    
    return nil
}
```

**ç»æµæ¨¡å‹çº¦æŸï¼š**

```
é‚€è¯·æˆæœ¬ = 5 å£°èª‰ç‚¹ï¼ˆé”å®šï¼‰
â”œâ”€â”€ è¢«æ‹…ä¿äººè¡¨ç°è‰¯å¥½ â†’ 6ä¸ªæœˆåè¿”è¿˜ + å¥–åŠ±1ç‚¹
â”œâ”€â”€ è¢«æ‹…ä¿äººæ™®é€š â†’ 6ä¸ªæœˆåè¿”è¿˜
â””â”€â”€ è¢«æ‹…ä¿äººè¿è§„ â†’ æ‰£é™¤ + è¿å¸¦è´£ä»»

è¿™æ ·ï¼Œç†æ€§èŠ‚ç‚¹ä¸ä¼šæ»¥å‘é‚€è¯·ï¼š
- é‚€è¯·åäºº = äºæŸ
- é‚€è¯·å¥½äºº = å¾®åˆ©
- å¤§é‡é‚€è¯· = å£°èª‰è€—å°½ï¼Œæ— æ³•ç»§ç»­
```

---

## ğŸ“ æ–‡ä»¶è§„åˆ’

```
internal/
â”œâ”€â”€ consensus/                    # æ–°å¢: å…±è¯†æ¨¡å—
â”‚   â”œâ”€â”€ consensus.go             # å…±è¯†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ consensus_test.go        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ pbft.go                  # PBFT å…±è¯†å®ç° (ç®€åŒ–ç‰ˆ)
â”‚   â”œâ”€â”€ message.go               # å…±è¯†æ¶ˆæ¯å®šä¹‰
â”‚   â””â”€â”€ state.go                 # å…±è¯†çŠ¶æ€æœº
â”‚
â”œâ”€â”€ guarantee/                    # æ–°å¢: æ‹…ä¿æ¨¡å—
â”‚   â”œâ”€â”€ guarantee.go             # æ‹…ä¿ç®¡ç†å™¨
â”‚   â”œâ”€â”€ guarantee_test.go        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ liability.go             # è¿å¸¦è´£ä»»å¤„ç†
â”‚   â””â”€â”€ storage.go               # æ‹…ä¿æ•°æ®å­˜å‚¨
â”‚
â”œâ”€â”€ ledger/                       # æ–°å¢: äº‹ä»¶è´¦æœ¬æ¨¡å—
â”‚   â”œâ”€â”€ ledger.go                # è´¦æœ¬ç®¡ç†å™¨
â”‚   â”œâ”€â”€ ledger_test.go           # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ event.go                 # äº‹ä»¶å®šä¹‰
â”‚   â”œâ”€â”€ snapshot.go              # å¿«ç…§ç®¡ç†
â”‚   â””â”€â”€ sync.go                  # è´¦æœ¬åŒæ­¥
â”‚
â””â”€â”€ auth/                         # ç°æœ‰æ¨¡å—æ‰©å±•
    â””â”€â”€ committee.go             # æ·»åŠ å…±è¯†ç›¸å…³æ–¹æ³•
```

---

## ğŸ”§ å®ç°æ­¥éª¤

### Phase 0: äº‹ä»¶è´¦æœ¬ (Day 0-1) ã€æ–°å¢ã€‘

**Step 0.1**: åˆ›å»º `internal/ledger/event.go`

```go
// EventType äº‹ä»¶ç±»å‹
type EventType string

const (
    EventNodeJoin         EventType = "NODE_JOIN"          // èŠ‚ç‚¹å…¥ç½‘
    EventNodeLeave        EventType = "NODE_LEAVE"         // èŠ‚ç‚¹é€€ç½‘
    EventReputationChange EventType = "REPUTATION_CHANGE"  // å£°èª‰å˜æ›´
    EventConsensusDecision EventType = "CONSENSUS_DECISION" // å…±è¯†å†³è®®
    EventViolation        EventType = "VIOLATION"          // è¿è§„è®°å½•
    EventLiabilitySettle  EventType = "LIABILITY_SETTLE"   // è¿å¸¦è´£ä»»ç»“ç®—
    EventGuaranteeCreate  EventType = "GUARANTEE_CREATE"   // åˆ›å»ºæ‹…ä¿
    EventGuaranteeExpire  EventType = "GUARANTEE_EXPIRE"   // æ‹…ä¿è¿‡æœŸ
)

// Event äº‹ä»¶è®°å½•
type Event struct {
    Sequence    uint64          `json:"seq"`        // åºåˆ—å·ï¼ˆå…¨å±€é€’å¢ï¼‰
    Type        EventType       `json:"type"`       // äº‹ä»¶ç±»å‹
    NodeID      string          `json:"node_id"`    // ç›¸å…³èŠ‚ç‚¹
    Data        json.RawMessage `json:"data"`       // äº‹ä»¶æ•°æ®ï¼ˆJSONï¼‰
    Timestamp   int64           `json:"timestamp"`  // æ—¶é—´æˆ³
    SignerID    string          `json:"signer_id"`  // ç­¾åè€…
    Signature   string          `json:"signature"`  // SM2ç­¾å
    PrevHash    string          `json:"prev_hash"`  // ä¸Šä¸€äº‹ä»¶å“ˆå¸Œï¼ˆé“¾å¼éªŒè¯ï¼‰
    Hash        string          `json:"hash"`       // æœ¬äº‹ä»¶å“ˆå¸Œ
}
```

**Step 0.2**: åˆ›å»º `internal/ledger/ledger.go`

```go
// Ledger äº‹ä»¶è´¦æœ¬
type Ledger struct {
    dataDir     string
    events      []*Event              // äº‹ä»¶åˆ—è¡¨
    index       map[string][]*Event   // èŠ‚ç‚¹ç´¢å¼•: nodeID -> events
    lastSeq     uint64                // æœ€ååºåˆ—å·
    lastHash    string                // æœ€åäº‹ä»¶å“ˆå¸Œ
    mu          sync.RWMutex
}

// AppendEvent è¿½åŠ äº‹ä»¶ï¼ˆéœ€è¦ç­¾åï¼‰
func (l *Ledger) AppendEvent(eventType EventType, nodeID string, data interface{}, signFunc SignFunc) (*Event, error)

// GetEventsByNode è·å–èŠ‚ç‚¹ç›¸å…³äº‹ä»¶
func (l *Ledger) GetEventsByNode(nodeID string) []*Event

// GetEventsByType è·å–æŒ‡å®šç±»å‹äº‹ä»¶
func (l *Ledger) GetEventsByType(eventType EventType) []*Event

// VerifyChain éªŒè¯äº‹ä»¶é“¾å®Œæ•´æ€§
func (l *Ledger) VerifyChain() error

// GetStateAt è·å–æŸæ—¶åˆ»çš„çŠ¶æ€å¿«ç…§
func (l *Ledger) GetStateAt(seq uint64) (*StateSnapshot, error)
```

**Step 0.3**: åˆ›å»º `internal/ledger/snapshot.go`

```go
// StateSnapshot çŠ¶æ€å¿«ç…§
type StateSnapshot struct {
    Sequence    uint64                      `json:"seq"`
    Timestamp   int64                       `json:"timestamp"`
    Nodes       map[string]*NodeState       `json:"nodes"`
    Guarantees  map[string]*GuaranteeState  `json:"guarantees"`
    Hash        string                      `json:"hash"`
}

// å®šæœŸç”Ÿæˆå¿«ç…§ï¼Œé¿å…æ¯æ¬¡éƒ½é‡æ”¾å…¨éƒ¨äº‹ä»¶
```

### Phase 1: æ‹…ä¿æœºåˆ¶ (Day 1-2)

**Step 1.1**: åˆ›å»º `internal/guarantee/guarantee.go`

```go
// GuaranteeManager æ‹…ä¿ç®¡ç†å™¨
type GuaranteeManager struct {
    dataDir     string
    guarantees  map[string]*Guarantee        // guaranteeID -> Guarantee
    byNode      map[string][]string          // nodeID -> []guaranteeID
    bySponsor   map[string][]string          // sponsorID -> []guaranteeID
    mu          sync.RWMutex
}

// CreateGuarantee åˆ›å»ºæ‹…ä¿ä¹¦
func (gm *GuaranteeManager) CreateGuarantee(
    sponsorID, sponsorPubKey string,
    newNodeID, newNodePubKey string,
    signFunc SignFunc,
) (*Guarantee, error)

// ValidateGuarantee éªŒè¯æ‹…ä¿ä¹¦
func (gm *GuaranteeManager) ValidateGuarantee(g *Guarantee) error

// GetActiveSponsorships è·å–èŠ‚ç‚¹çš„æœ‰æ•ˆæ‹…ä¿
func (gm *GuaranteeManager) GetActiveSponsorships(sponsorID string) ([]*Guarantee, error)
```

**Step 1.2**: åˆ›å»º `internal/guarantee/liability.go`

```go
// ProcessViolation å¤„ç†è¿è§„ï¼Œè®¡ç®—è¿å¸¦è´£ä»»
func (gm *GuaranteeManager) ProcessViolation(
    newNodeID string,
    violationType string,
    originalPenalty float64,
) (*LiabilityRecord, error)

// SettleLiability ç»“ç®—è¿å¸¦è´£ä»»
func (gm *GuaranteeManager) SettleLiability(liabilityID string) error
```

### Phase 2: å…±è¯†æœºåˆ¶ (Day 2-4)

**Step 2.1**: åˆ›å»º `internal/consensus/consensus.go`

```go
// ConsensusManager å…±è¯†ç®¡ç†å™¨
type ConsensusManager struct {
    nodeID          string
    committee       *CommitteeView
    pendingRequests map[string]*ConsensusJoinRequest
    votes           map[string]map[string]*JoinConsensusVote  // reqID -> voterID -> vote
    mu              sync.RWMutex
}

// SubmitJoinRequest æäº¤å…¥ç½‘ç”³è¯·
func (cm *ConsensusManager) SubmitJoinRequest(req *ConsensusJoinRequest) error

// Vote å¯¹å…¥ç½‘ç”³è¯·æŠ•ç¥¨
func (cm *ConsensusManager) Vote(requestID string, agree bool, reason string) error

// CheckConsensus æ£€æŸ¥å…±è¯†çŠ¶æ€
func (cm *ConsensusManager) CheckConsensus(requestID string) (*JoinConsensusResult, error)
```

**Step 2.2**: åˆ›å»º `internal/consensus/pbft.go`

```go
// PBFTState å…±è¯†çŠ¶æ€
type PBFTState struct {
    Phase           ConsensusPhase
    PrepareCount    int
    CommitCount     int
    PrepareQuorum   bool
    CommitQuorum    bool
}

// handlePrePrepare å¤„ç† Pre-prepare æ¶ˆæ¯
func (cm *ConsensusManager) handlePrePrepare(msg *ConsensusMessage) error

// handlePrepare å¤„ç† Prepare æ¶ˆæ¯  
func (cm *ConsensusManager) handlePrepare(msg *ConsensusMessage) error

// handleCommit å¤„ç† Commit æ¶ˆæ¯
func (cm *ConsensusManager) handleCommit(msg *ConsensusMessage) error
```

### Phase 3: é›†æˆä¸æµ‹è¯• (Day 4-5)

**Step 3.1**: æ‰©å±•ç°æœ‰æ¨¡å—

- ä¿®æ”¹ `internal/auth/committee.go`ï¼šæ·»åŠ å…±è¯†éªŒè¯æ–¹æ³•
- ä¿®æ”¹ `internal/genesis/genesis.go`ï¼šé›†æˆæ‹…ä¿éªŒè¯
- ä¿®æ”¹ `internal/voting/voting.go`ï¼šæ·»åŠ å…¥ç½‘å…±è¯†æŠ•ç¥¨ç±»å‹

**Step 3.2**: æ·»åŠ  HTTP API

```go
// æ‹…ä¿ç›¸å…³ API
POST /api/v1/guarantee/create     // åˆ›å»ºæ‹…ä¿ä¹¦
GET  /api/v1/guarantee/{id}       // è·å–æ‹…ä¿ä¹¦
GET  /api/v1/guarantee/sponsor/{nodeID}  // è·å–èŠ‚ç‚¹çš„æ‹…ä¿

// å…¥ç½‘å…±è¯† API
POST /api/v1/join/request         // æäº¤å…¥ç½‘ç”³è¯·
GET  /api/v1/join/status/{id}     // æŸ¥è¯¢ç”³è¯·çŠ¶æ€
POST /api/v1/join/vote            // æŠ•ç¥¨
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

| æµ‹è¯•é¡¹ | æ–‡ä»¶ | è¦†ç›–å†…å®¹ |
|--------|------|---------|
| æ‹…ä¿ä¹¦åˆ›å»ºä¸éªŒè¯ | guarantee_test.go | ç­¾åã€æœ‰æ•ˆæœŸã€å‚æ•°éªŒè¯ |
| è¿å¸¦è´£ä»»è®¡ç®— | liability_test.go | è¿è§„å¤„ç†ã€æ¯”ä¾‹è®¡ç®— |
| å…±è¯†æµç¨‹ | consensus_test.go | æŠ•ç¥¨ã€æ³•å®šäººæ•°ã€è¶…æ—¶ |
| PBFTçŠ¶æ€æœº | pbft_test.go | é˜¶æ®µè½¬æ¢ã€æ¶ˆæ¯å¤„ç† |

### é›†æˆæµ‹è¯•

```go
func TestJoinNetworkWithGuarantee(t *testing.T) {
    // 1. åˆ›å»ºç½‘ç»œï¼ˆ5ä¸ªèŠ‚ç‚¹ï¼‰
    // 2. è€èŠ‚ç‚¹ç­¾å‘æ‹…ä¿ä¹¦
    // 3. æ–°èŠ‚ç‚¹æäº¤å…¥ç½‘ç”³è¯·
    // 4. å§”å‘˜ä¼šæŠ•ç¥¨
    // 5. éªŒè¯å…±è¯†ç»“æœ
    // 6. éªŒè¯æ–°èŠ‚ç‚¹åŠ å…¥
}

func TestLiabilityOnViolation(t *testing.T) {
    // 1. æ–°èŠ‚ç‚¹å…¥ç½‘ï¼ˆæœ‰æ‹…ä¿ï¼‰
    // 2. æ–°èŠ‚ç‚¹è¿è§„
    // 3. å¤„ç†è¿å¸¦è´£ä»»
    // 4. éªŒè¯æ‹…ä¿äººæƒ©ç½š
}
```

---

## âš ï¸ é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| å…±è¯†è¶…æ—¶ | å…¥ç½‘å¤±è´¥ | è®¾ç½®åˆç†è¶…æ—¶ï¼Œæ”¯æŒé‡è¯• |
| å§”å‘˜ä¼šæˆå‘˜ç¦»çº¿ | æ— æ³•è¾¾æˆå…±è¯† | åŠ¨æ€è°ƒæ•´æ³•å®šäººæ•° |
| æ‹…ä¿äººæ¶æ„æ‹…ä¿ | å¼•å…¥ä¸è‰¯èŠ‚ç‚¹ | é™åˆ¶æ‹…ä¿æ•°é‡+è¿å¸¦è´£ä»» |
| åˆ†å‰/ä¸ä¸€è‡´ | ç½‘ç»œåˆ†è£‚ | ä½¿ç”¨ç¡®å®šæ€§ç®—æ³•ï¼Œä¸»èŠ‚ç‚¹è½®æ¢ |

---

## ğŸ“ éªŒæ”¶æ ‡å‡†

- [ ] æ‹…ä¿ä¹¦åˆ›å»ºã€ç­¾åã€éªŒè¯å®Œæ•´
- [ ] å…±è¯†æµç¨‹ Pre-prepare â†’ Prepare â†’ Commit æ­£å¸¸
- [ ] 2/3 å¤šæ•°åŒæ„æ‰èƒ½é€šè¿‡
- [ ] è¿å¸¦è´£ä»»æ­£ç¡®è®¡ç®—å’Œç»“ç®—
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] HTTP API å¯ç”¨

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [PBFT åŸå§‹è®ºæ–‡](http://pmg.csail.mit.edu/papers/osdi99.pdf)
- [PrivateTrackerBlockchain](https://github.com/hyfree/PrivateTrackerBlockchain)
- [Event Sourcing Pattern](https://martinfowler.com/eaaDev/EventSourcing.html)
- [Task 07 æŠ•ç¥¨æœºåˆ¶](task07æŠ•ç¥¨æœºåˆ¶.md)
- [Task 15 åˆ›ä¸–èŠ‚ç‚¹](task15åˆ›ä¸–èŠ‚ç‚¹.md)

---

## ğŸ“‹ PTB åŠŸèƒ½å¯¹ç…§è¡¨

ä¸‹è¡¨åˆ†æ PrivateTrackerBlockchain çš„åŠŸèƒ½ï¼Œè¯„ä¼° AgentNetwork æ˜¯å¦éœ€è¦ï¼š

| PTB åŠŸèƒ½ | æ˜¯å¦éœ€è¦ | AgentNetwork æ–¹æ¡ˆ | ç†ç”± |
|---------|:-------:|------------------|------|
| PBFT å…±è¯† | âœ… éœ€è¦ | ç®€åŒ–ç‰ˆ PBFT | å…³é”®å†³ç­–éœ€è¦å¤šæ•°åŒæ„ |
| POW å…±è¯†é€‰è¶…çº§èŠ‚ç‚¹ | âŒ ä¸éœ€è¦ | å£°èª‰+æŠµæŠ¼é€‰ä¸¾ | POW èƒ½è€—é«˜ï¼Œä¸é€‚åˆ Agent ç½‘ç»œ |
| é“¾å¼è´¦æœ¬ | âš ï¸ ç®€åŒ– | äº‹ä»¶æ—¥å¿— + å“ˆå¸Œé“¾ | ä¸éœ€è¦å®Œæ•´åŒºå—ï¼Œäº‹ä»¶é“¾å³å¯ |
| åˆ†å¸ƒå¼è´¦æœ¬ | âœ… éœ€è¦ | äº‹ä»¶æ—¥å¿—å¤šèŠ‚ç‚¹å¤åˆ¶ | éœ€è¦æ•°æ®å†—ä½™ |
| NAT ç©¿è¶Š | âœ… å·²æœ‰ | libp2p å†…ç½® | Task 01 å·²å®ç° |
| åŒºå—é“¾è®°å½•èµ„æº | âŒ ä¸éœ€è¦ | ä¸æ¶‰åŠèµ„æºäº¤æ˜“ | AgentNetwork ä¸æ˜¯æ–‡ä»¶åˆ†äº«ç½‘ç»œ |
| å…±è¯†å‡è¡¡èµ„æº | âŒ ä¸éœ€è¦ | N/A | æ— æ–‡ä»¶èµ„æºæ¦‚å¿µ |
| å–å®¶ç™»è®°èµ„æº | âŒ ä¸éœ€è¦ | N/A | ä¸æ˜¯äº¤æ˜“å¸‚åœº |
| ä¹°å®¶ä¹°å…¥èµ„æº | âŒ ä¸éœ€è¦ | N/A | ä¸æ˜¯äº¤æ˜“å¸‚åœº |
| äº¤æ˜“ç»“ç®— | âŒ ä¸éœ€è¦ | N/A | æ— ç§¯åˆ†è½¬è´¦ |
| å…±è¯†é‚€è¯·å…¥ç½‘ | âœ… éœ€è¦ | æ‹…ä¿ + å§”å‘˜ä¼šå…±è¯† | æ ¸å¿ƒåŠŸèƒ½ |
| å…±è¯†å‰”é™¤èŠ‚ç‚¹ | âœ… å·²æœ‰ | Task 07 æŠ•ç¥¨æœºåˆ¶ | æ‰©å±•æ”¯æŒå…±è¯†ç¡®è®¤ |
| å…±è¯†æ’é™¤èµ„æº | âŒ ä¸éœ€è¦ | N/A | æ— èµ„æºé»‘åå•éœ€æ±‚ |

### æ€»ç»“

**é‡‡çº³çš„è®¾è®¡æ€è·¯ï¼š**
- âœ… æ‹…ä¿å…¥ç½‘ + è¿å¸¦è´£ä»»
- âœ… å…±è¯†éªŒè¯å…³é”®å†³ç­–
- âœ… äº‹ä»¶æ—¥å¿—ï¼ˆè½»é‡çº§è´¦æœ¬ï¼‰
- âœ… å¤šèŠ‚ç‚¹å¤åˆ¶

**ä¸é‡‡çº³çš„è®¾è®¡ï¼š**
- âŒ POW æŒ–çŸ¿
- âŒ å®Œæ•´åŒºå—é“¾
- âŒ ç§¯åˆ†äº¤æ˜“ç³»ç»Ÿ
- âŒ èµ„æºå¸‚åœº

---

## ğŸ¯ æœ€ç»ˆæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AgentNetwork æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   HTTP API  â”‚    â”‚   P2P ç½‘ç»œ  â”‚    â”‚   CLI       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                  â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚                   æœåŠ¡å±‚                           â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚         â”‚
â”‚  â”‚  â”‚ æ‹…ä¿æœåŠ¡  â”‚  â”‚ å…±è¯†æœåŠ¡  â”‚  â”‚ å£°èª‰æœåŠ¡  â”‚        â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚             â”‚             â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              äº‹ä»¶è´¦æœ¬ (Event Ledger)              â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”        â”‚         â”‚
â”‚  â”‚  â”‚ E1  â”‚â†’â”‚ E2  â”‚â†’â”‚ E3  â”‚â†’â”‚ E4  â”‚â†’â”‚ ... â”‚        â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜        â”‚         â”‚
â”‚  â”‚                    â†“                             â”‚         â”‚
â”‚  â”‚              å®šæœŸå¿«ç…§ (Snapshot)                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚                   å­˜å‚¨å±‚                           â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚         â”‚
â”‚  â”‚  â”‚ äº‹ä»¶æ–‡ä»¶  â”‚  â”‚ å¿«ç…§æ–‡ä»¶  â”‚  â”‚ ç´¢å¼•æ–‡ä»¶  â”‚        â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
