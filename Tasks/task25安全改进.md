# ğŸ“– Task 25: å®‰å…¨æœºåˆ¶æ”¹è¿›è®¾è®¡

> **åˆ›å»ºæ—¶é—´**: 2026-02-04  
> **çŠ¶æ€**: è¿›è¡Œä¸­  
> **ä¼˜å…ˆçº§**: P0  
> **æ¥æº**: Task 24 å®‰å…¨é£é™©è¯„ä¼°åé¦ˆ

---

## 1. æ¶æ„æ¾„æ¸…ï¼šåŒç«¯å£è®¾è®¡

### 1.1 ç«¯å£èŒè´£åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AgentNetwork èŠ‚ç‚¹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    P2P ç«¯å£ (å…¬å¼€)   â”‚    â”‚  ç®¡ç† API ç«¯å£ (æœ¬åœ°) â”‚         â”‚
â”‚  â”‚    é»˜è®¤: 4001        â”‚    â”‚    é»˜è®¤: 18345       â”‚         â”‚
â”‚  â”‚                     â”‚    â”‚                      â”‚         â”‚
â”‚  â”‚  â€¢ èŠ‚ç‚¹é—´é€šä¿¡        â”‚    â”‚  â€¢ Agent è°ƒç”¨        â”‚         â”‚
â”‚  â”‚  â€¢ DHT å‘ç°          â”‚    â”‚  â€¢ ç®¡ç†å‘˜æ“ä½œ        â”‚         â”‚
â”‚  â”‚  â€¢ æ¶ˆæ¯ä¼ é€’          â”‚    â”‚  â€¢ æœ¬åœ°ç›‘æ§          â”‚         â”‚
â”‚  â”‚  â€¢ å£°èª‰åŒæ­¥          â”‚    â”‚                      â”‚         â”‚
â”‚  â”‚                     â”‚    â”‚  ğŸ”’ Token è®¤è¯       â”‚         â”‚
â”‚  â”‚  âš ï¸ å…¬ç½‘æš´éœ²         â”‚    â”‚  ğŸ”’ é˜²ç«å¢™ä¿æŠ¤       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤–éƒ¨èŠ‚ç‚¹ â†â†’ P2Pç«¯å£ (libp2p ç­¾åéªŒè¯)
æœ¬åœ°Agent/ç®¡ç†å‘˜ â†â†’ ç®¡ç†APIç«¯å£ (Tokenè®¤è¯ + é˜²ç«å¢™)
```

### 1.2 å®‰å…¨æ¨¡å‹

| ç«¯å£ | ç»‘å®šåœ°å€ | è®¤è¯æ–¹å¼ | ä¿æŠ¤æªæ–½ |
|------|---------|---------|---------|
| P2P (4001) | 0.0.0.0 | libp2p èŠ‚ç‚¹èº«ä»½ç­¾å | åè®®çº§ç­¾åéªŒè¯ |
| ç®¡ç†API (18345) | 127.0.0.1 | Token è®¤è¯ | æœ¬åœ°ç»‘å®š + é˜²ç«å¢™ |

---

## 2. ç®¡ç† API Token è®¤è¯æœºåˆ¶

### 2.1 è®¾è®¡æ–¹æ¡ˆ

#### Token ç”Ÿæˆä¸å­˜å‚¨

```go
// internal/httpapi/auth.go

const (
    TokenLength = 32  // 256 bits
    TokenHeader = "X-API-Token"
)

// AuthConfig è®¤è¯é…ç½®
type AuthConfig struct {
    Token           string `json:"api_token"`           // API Token
    TokenGenerated  bool   `json:"token_generated"`     // æ˜¯å¦å·²ç”Ÿæˆ
    AllowedIPs      []string `json:"allowed_ips"`       // å…è®¸çš„IP (å¯é€‰)
}

// GenerateToken ç”Ÿæˆéšæœº Token
func GenerateToken() (string, error) {
    bytes := make([]byte, TokenLength)
    if _, err := rand.Read(bytes); err != nil {
        return "", err
    }
    return hex.EncodeToString(bytes), nil
}
```

#### é…ç½®æ–‡ä»¶æ ¼å¼

```json
{
  "node_id": "12D3KooW...",
  "p2p_port": 4001,
  "api_port": 18345,
  "api_bind": "127.0.0.1",
  "api_token": "a1b2c3d4e5f6...",
  "api_token_generated": true
}
```

#### é¦–æ¬¡å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¦–æ¬¡å¯åŠ¨æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ api_token
   â”‚
   â”œâ”€ ä¸å­˜åœ¨ â†’ ç”Ÿæˆæ–° Token
   â”‚           â”œâ”€ ä¿å­˜åˆ°é…ç½®æ–‡ä»¶
   â”‚           â””â”€ æ‰“å°åˆ°æ§åˆ¶å° (ä»…é¦–æ¬¡)
   â”‚
   â””â”€ å­˜åœ¨ â†’ ä½¿ç”¨å·²æœ‰ Token

æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” API Token å·²ç”Ÿæˆ (è¯·å¦¥å–„ä¿ç®¡ï¼Œä»…æ˜¾ç¤ºä¸€æ¬¡):

   a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef12

   ä½¿ç”¨æ–¹å¼:
   curl -H "X-API-Token: <token>" http://127.0.0.1:18345/api/v1/...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 2.2 Token éªŒè¯ä¸­é—´ä»¶

```go
// internal/httpapi/middleware.go

func (s *Server) tokenAuthMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // å¥åº·æ£€æŸ¥ç«¯ç‚¹æ— éœ€è®¤è¯
        if r.URL.Path == "/health" {
            next(w, r)
            return
        }
        
        // è·å– Token
        token := r.Header.Get(TokenHeader)
        if token == "" {
            token = r.URL.Query().Get("token")  // å¤‡é€‰: URLå‚æ•°
        }
        
        // éªŒè¯ Token
        if !s.validateToken(token) {
            s.writeError(w, http.StatusUnauthorized, "invalid or missing API token")
            return
        }
        
        next(w, r)
    }
}

func (s *Server) validateToken(token string) bool {
    if s.config.APIToken == "" {
        return false  // Token æœªé…ç½®æ—¶æ‹’ç»æ‰€æœ‰è¯·æ±‚
    }
    // ä½¿ç”¨å¸¸é‡æ—¶é—´æ¯”è¾ƒé˜²æ­¢æ—¶åºæ”»å‡»
    return subtle.ConstantTimeCompare([]byte(token), []byte(s.config.APIToken)) == 1
}
```

### 2.3 CLI å‘½ä»¤æ”¯æŒ

```bash
# æŸ¥çœ‹å½“å‰ Token (éœ€è¦ç¡®è®¤)
agentnetwork token show

# é‡æ–°ç”Ÿæˆ Token
agentnetwork token regenerate

# æ’¤é”€ Token (ç¦ç”¨ API)
agentnetwork token revoke
```

### 2.4 å®ç°ä»»åŠ¡æ¸…å•

| ID | ä»»åŠ¡ | ä¼°æ—¶ | çŠ¶æ€ |
|:--:|------|:---:|:---:|
| T25-01 | å®ç° Token ç”Ÿæˆé€»è¾‘ | 0.5d | ğŸ“‹ |
| T25-02 | ä¿®æ”¹é…ç½®æ–‡ä»¶ç»“æ„ | 0.5d | ğŸ“‹ |
| T25-03 | å®ç°è®¤è¯ä¸­é—´ä»¶ | 1d | ğŸ“‹ |
| T25-04 | é¦–æ¬¡å¯åŠ¨ Token æ‰“å° | 0.5d | ğŸ“‹ |
| T25-05 | CLI token å‘½ä»¤ | 0.5d | ğŸ“‹ |
| T25-06 | å•å…ƒæµ‹è¯• | 1d | ğŸ“‹ |

**æ€»ä¼°æ—¶**: 4 å¤©

---

## 3. å£°èª‰ç³»ç»Ÿé˜²æ“çºµæœºåˆ¶

### 3.1 é—®é¢˜åˆ†æ

**æ”»å‡»æ–¹å¼**: æ¶æ„èŠ‚ç‚¹ Aã€Bã€C äº’ç›¸åˆ·å£°èª‰
```
A å¥–åŠ± B (+10) â†’ B å¥–åŠ± C (+10) â†’ C å¥–åŠ± A (+10) â†’ å¾ªç¯...
```

### 3.2 BitTorrent çš„è§£å†³æ–¹æ¡ˆ

BT ç½‘ç»œé‡‡ç”¨ **Tit-for-Tat (ä»¥ç‰™è¿˜ç‰™)** ç­–ç•¥ï¼š

1. **ç›´æ¥äº’æƒ **: åªç»™ä¸Šä¼ ç»™ä½ çš„äººæä¾›ä¸‹è½½
2. **ä¹è§‚è§£é”**: å‘¨æœŸæ€§éšæœºè§£é”ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‘ç°æ–°çš„å¥½ä¼™ä¼´
3. **æœ¬åœ°è§†è§’**: æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹è®¡ç®—ï¼Œä¸ä¾èµ–å…¨å±€å£°èª‰

### 3.3 AgentNetwork æ”¹è¿›æ–¹æ¡ˆ

#### æ–¹æ¡ˆ A: ä»»åŠ¡è¯æ˜ (Proof of Task)

å£°èª‰åªèƒ½é€šè¿‡**å®é™…å®Œæˆä»»åŠ¡**è·å¾—ï¼Œè€ŒéèŠ‚ç‚¹é—´ç›´æ¥äº’è¯„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»»åŠ¡è¯æ˜æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ä»»åŠ¡å‘å¸ƒè€… â†’ å‘å¸ƒä»»åŠ¡åˆ°ç½‘ç»œ
2. æ‰§è¡Œè€… â†’ å®Œæˆä»»åŠ¡ï¼Œæäº¤ç»“æœ
3. éªŒè¯è€…(éšæœºé€‰å–) â†’ éªŒè¯ç»“æœæ­£ç¡®æ€§
4. è‹¥é€šè¿‡ â†’ æ‰§è¡Œè€…è·å¾—å£°èª‰å¥–åŠ±

å…³é”®: 
â€¢ éªŒè¯è€…éšæœºé€‰å–ï¼Œæ— æ³•é¢„çŸ¥
â€¢ åˆ·å£°èª‰éœ€è¦å®é™…æ¶ˆè€—è®¡ç®—èµ„æº
â€¢ è™šå‡ä»»åŠ¡ä¼šè¢«éšæœºéªŒè¯å‘ç°
```

```go
// å£°èª‰æ¥æºç±»å‹
type ReputationSource string

const (
    SourceTaskCompletion  ReputationSource = "task_completion"   // ä»»åŠ¡å®Œæˆ (ä¸»è¦)
    SourceRelayService    ReputationSource = "relay_service"     // ä¸­ç»§æœåŠ¡
    SourceStorageService  ReputationSource = "storage_service"   // å­˜å‚¨æœåŠ¡
    SourceAuditPass       ReputationSource = "audit_pass"        // å®¡è®¡é€šè¿‡
    // SourcePeerRating   ReputationSource = "peer_rating"       // ç¦ç”¨: èŠ‚ç‚¹äº’è¯„
)

// åªæ¥å—å¯éªŒè¯æ¥æºçš„å£°èª‰
func (rm *ReputationManager) AddReputation(nodeID string, delta float64, source ReputationSource, proof *TaskProof) error {
    if source == SourcePeerRating {
        return errors.New("peer rating is disabled")
    }
    
    // éªŒè¯è¯æ˜
    if !rm.verifyProof(proof) {
        return errors.New("invalid proof")
    }
    
    // ...
}
```

#### æ–¹æ¡ˆ B: å£°èª‰è¡°å‡ + æ—¶é—´æƒé‡

```go
// å£°èª‰è®¡ç®—å…¬å¼
// Score = Î£(task_reward * time_decay * diversity_factor)

// æ—¶é—´è¡°å‡: è¶Šæ—§çš„å£°èª‰è´¡çŒ®è¶Šå°
func timeDecay(taskTime time.Time) float64 {
    age := time.Since(taskTime)
    halfLife := 30 * 24 * time.Hour  // 30å¤©åŠè¡°æœŸ
    return math.Pow(0.5, float64(age)/float64(halfLife))
}

// å¤šæ ·æ€§å› å­: æ¥è‡ªåŒä¸€èŠ‚ç‚¹çš„å£°èª‰è´¡çŒ®é€’å‡
func diversityFactor(sourceNodeID string, existingContributions map[string]int) float64 {
    count := existingContributions[sourceNodeID]
    return 1.0 / math.Pow(2.0, float64(count))  // 1, 0.5, 0.25, 0.125...
}
```

#### æ–¹æ¡ˆ C: æœ¬åœ°è§†è§’ + ä¿¡ä»»ä¼ é€’ (ç±»ä¼¼ PageRank)

æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤è‡ªå·±çš„ä¿¡ä»»è§†å›¾ï¼Œä¿¡ä»»é€šè¿‡ç½‘ç»œä¼ é€’ä½†æœ‰è¡°å‡ï¼š

```go
// æœ¬åœ°ä¿¡ä»»è®¡ç®—
type LocalTrustView struct {
    directTrust    map[string]float64  // ç›´æ¥äº¤äº’äº§ç”Ÿçš„ä¿¡ä»»
    indirectTrust  map[string]float64  // é‚»å±…æ¨èçš„ä¿¡ä»»
}

// ä¿¡ä»»ä¼ é€’å…¬å¼
// T(Aâ†’C) = T(Aâ†’B) * T(Bâ†’C) * decay
// ä½† T(Aâ†’C) æ°¸è¿œä¸èƒ½è¶…è¿‡ T(Aâ†’B)
```

### 3.4 æ¨èæ–¹æ¡ˆ

**é‡‡ç”¨æ–¹æ¡ˆ A (ä»»åŠ¡è¯æ˜) + æ–¹æ¡ˆ B (æ—¶é—´è¡°å‡) ç»„åˆ**

- å£°èª‰ä¸»è¦æ¥æºï¼šå®Œæˆå¯éªŒè¯çš„ä»»åŠ¡
- è¾…åŠ©æ¥æºï¼šæä¾›ç½‘ç»œæœåŠ¡ï¼ˆä¸­ç»§ã€å­˜å‚¨ï¼‰
- ç¦ç”¨ï¼šèŠ‚ç‚¹é—´ç›´æ¥äº’è¯„
- åŠ å…¥ï¼šæ—¶é—´è¡°å‡å’Œå¤šæ ·æ€§å› å­

### 3.5 å®ç°ä»»åŠ¡æ¸…å•

| ID | ä»»åŠ¡ | ä¼°æ—¶ | çŠ¶æ€ |
|:--:|------|:---:|:---:|
| T25-07 | é‡æ„å£°èª‰æ¥æºç±»å‹ | 1d | ğŸ“‹ |
| T25-08 | å®ç°ä»»åŠ¡è¯æ˜æœºåˆ¶ | 2d | ğŸ“‹ |
| T25-09 | æ·»åŠ æ—¶é—´è¡°å‡è®¡ç®— | 0.5d | ğŸ“‹ |
| T25-10 | æ·»åŠ å¤šæ ·æ€§å› å­ | 0.5d | ğŸ“‹ |
| T25-11 | ç¦ç”¨ç›´æ¥äº’è¯„ | 0.5d | ğŸ“‹ |
| T25-12 | æ›´æ–°ç›¸å…³æµ‹è¯• | 1d | ğŸ“‹ |

**æ€»ä¼°æ—¶**: 5.5 å¤©

---

## 4. åˆ›ä¸–é‚€è¯·æœºåˆ¶è¯´æ˜

### 4.1 è®¾è®¡æ„å›¾

åˆ›ä¸–èŠ‚ç‚¹çš„é‚€è¯·æœºåˆ¶æ˜¯**ç½‘ç»œå†·å¯åŠ¨**é˜¶æ®µçš„å¿…è¦æ‰‹æ®µï¼š

```
ç½‘ç»œç”Ÿå‘½å‘¨æœŸ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  å†·å¯åŠ¨æœŸ          æˆé•¿æœŸ            æˆç†ŸæœŸ               â”‚
â”‚  (1-100èŠ‚ç‚¹)      (100-10000)       (10000+)             â”‚
â”‚                                                            â”‚
â”‚  åˆ›ä¸–èŠ‚ç‚¹ä¸»å¯¼  â†’  é‚€è¯·æƒåˆ†æ•£  â†’  åˆ›ä¸–=æ™®é€šèŠ‚ç‚¹           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è‡ªç„¶è¿‡æ¸¡æœºåˆ¶

å½“ç½‘ç»œæˆç†Ÿåï¼Œåˆ›ä¸–èŠ‚ç‚¹è‡ªç„¶å¤±å»ç‰¹æ®Šåœ°ä½ï¼š

```go
// é‚€è¯·æƒé™æ£€æŸ¥
func (gm *GenesisManager) CanInvite(nodeID string) bool {
    // æ£€æŸ¥å£°èª‰æ˜¯å¦è¾¾æ ‡ (æ‰€æœ‰èŠ‚ç‚¹ç›¸åŒæ ‡å‡†)
    reputation := gm.getReputation(nodeID)
    return reputation >= gm.genesis.MinInviterReputation
}

// åˆ›ä¸–èŠ‚ç‚¹æ²¡æœ‰ç‰¹æ®ŠåŠ åˆ†
// å£°èª‰åŒæ ·ä¼šè¡°å‡
// æœ€ç»ˆä¸æ™®é€šèŠ‚ç‚¹æ— å¼‚
```

### 4.3 ç°æœ‰ä¿æŠ¤æœºåˆ¶

1. **é‚€è¯·è€…å£°èª‰é—¨æ§›**: `MinInviterReputation = 10`
2. **é‚€è¯·å‡½æœ‰æ•ˆæœŸ**: `InvitationValidHours = 72`
3. **è¢«é‚€è¯·è€…åˆå§‹å£°èª‰ä½**: `InitialReputation = 1`

### 4.4 å¯é€‰å¢å¼º (ä½ä¼˜å…ˆçº§)

å¦‚æœæœªæ¥éœ€è¦ï¼Œå¯ä»¥æ·»åŠ ï¼š

```go
// å¯é€‰: é‚€è¯·é…é¢
type InvitationQuota struct {
    NodeID       string
    DailyQuota   int       // æ¯æ—¥é…é¢
    UsedToday    int       // ä»Šæ—¥å·²ç”¨
    TotalInvited int       // æ€»é‚€è¯·æ•°
}

// é…é¢éšå£°èª‰å¢é•¿
func getQuota(reputation float64) int {
    return int(math.Log2(reputation + 1))  // å£°èª‰100 â†’ é…é¢çº¦7
}
```

**ç»“è®º**: å½“å‰è®¾è®¡å¯æ¥å—ï¼Œæš‚ä¸ä¿®æ”¹ã€‚

---

## 5. è¶…çº§èŠ‚ç‚¹é€‰ä¸¾å®‰å…¨æ€§åˆ†æ

### 5.1 æ”»å‡»æˆæœ¬åˆ†æ

**å‡è®¾æ”»å‡»è€…è¦æ§åˆ¶é€‰ä¸¾ç»“æœ**:

| ç½‘ç»œè§„æ¨¡ | éœ€æ§åˆ¶èŠ‚ç‚¹æ•° (>50%) | æ‰€éœ€å£°èª‰æ€»é‡ | æ”»å‡»éš¾åº¦ |
|---------|-------------------|-------------|---------|
| 100 èŠ‚ç‚¹ | 51 | ~2550 | ä½ |
| 1,000 èŠ‚ç‚¹ | 501 | ~25050 | ä¸­ |
| 10,000 èŠ‚ç‚¹ | 5001 | ~250050 | é«˜ |
| 100,000 èŠ‚ç‚¹ | 50001 | ~2500050 | æé«˜ |

**å£°èª‰è·å–æˆæœ¬** (å‡è®¾æ¯ä¸ªä»»åŠ¡å¥–åŠ± 1 å£°èª‰):
- æ§åˆ¶ 51 èŠ‚ç‚¹ Ã— 50 å£°èª‰ = 2550 ä¸ªä»»åŠ¡
- æ¯ä¸ªä»»åŠ¡æ¶ˆè€—è®¡ç®—èµ„æº
- éœ€è¦çœŸå®çš„ä»»åŠ¡æ¥æº

### 5.2 ç°æœ‰ä¿æŠ¤æœºåˆ¶

1. **å€™é€‰é—¨æ§›**: `MinReputation = 50`, `MinStake = 30`
2. **æŠ•ç¥¨æƒé‡**: åŸºäºå£°èª‰å’Œè´¨æŠ¼
3. **ä»»æœŸåˆ¶**: è¶…çº§èŠ‚ç‚¹å®šæœŸè½®æ¢
4. **å®¡è®¡æœºåˆ¶**: è¶…çº§èŠ‚ç‚¹è¡Œä¸ºè¢«ç›‘ç£

### 5.3 é¢å¤–å»ºè®® (ä¸­æœŸå®ç°)

#### éšæœºæ€§å¢å¼º

```go
// é€‰ä¸¾ç»“æœåŠ å…¥éšæœºå› å­
func (s *SuperNodeManager) FinalizeElection() ([]string, error) {
    // æŒ‰ç¥¨æ•°æ’åº
    candidates := s.getSortedCandidates()
    
    // ä» Top N*2 ä¸­éšæœºé€‰æ‹© N ä¸ª
    // é˜²æ­¢å®Œå…¨å¯é¢„æµ‹çš„ç»“æœ
    pool := candidates[:min(len(candidates), s.config.MaxSuperNodes*2)]
    winners := randomSelect(pool, s.config.MaxSuperNodes, s.getRandomSeed())
    
    return winners, nil
}

// éšæœºç§å­æ¥è‡ªå¤šä¸ªè¶…çº§èŠ‚ç‚¹çš„è¾“å…¥
func (s *SuperNodeManager) getRandomSeed() []byte {
    // VRF (Verifiable Random Function) å®ç°
    // æ¯ä¸ªè¶…çº§èŠ‚ç‚¹è´¡çŒ®ä¸€éƒ¨åˆ†éšæœºæ€§
}
```

#### æ¸è¿›å¼å»ä¸­å¿ƒåŒ–

```
é˜¶æ®µ1: åˆ›ä¸–èŠ‚ç‚¹æŒ‡å®šåˆå§‹è¶…çº§èŠ‚ç‚¹
é˜¶æ®µ2: é€‰ä¸¾äº§ç”Ÿï¼Œä½†éœ€è¦åˆ›ä¸–èŠ‚ç‚¹ç¡®è®¤
é˜¶æ®µ3: å®Œå…¨è‡ªæ²»é€‰ä¸¾ (ç½‘ç»œæˆç†Ÿå)
```

### 5.4 ç»“è®º

å½“å‰è®¾è®¡åœ¨å¤§è§„æ¨¡ç½‘ç»œä¸­æ˜¯å®‰å…¨çš„ã€‚å»ºè®®ï¼š

1. **çŸ­æœŸ**: ä¿æŒç°æœ‰è®¾è®¡
2. **ä¸­æœŸ**: æ·»åŠ éšæœºæ€§å¢å¼º
3. **é•¿æœŸ**: è€ƒè™‘ VRF ç­‰å¯†ç å­¦æ–¹æ¡ˆ

---

## 6. æ€»ä½“å®ç°è®¡åˆ’

### 6.1 ä¼˜å…ˆçº§æ’åº

| ä¼˜å…ˆçº§ | åŠŸèƒ½ | ä¼°æ—¶ | ç†ç”± |
|:---:|------|:---:|------|
| P0 | Token è®¤è¯æœºåˆ¶ | 4d | ç›´æ¥å¯åˆ©ç”¨çš„æ¼æ´ |
| P1 | å£°èª‰é˜²æ“çºµæ”¹è¿› | 5.5d | ç³»ç»Ÿæ€§é—®é¢˜ |
| P2 | é€‰ä¸¾éšæœºæ€§å¢å¼º | 3d | ä¸­æœŸæ”¹è¿› |
| - | åˆ›ä¸–é‚€è¯·é…é¢ | - | æš‚ä¸éœ€è¦ |

### 6.2 å®ç°é˜¶æ®µ

```
Phase 1 (æœ¬å‘¨): Token è®¤è¯
â”œâ”€â”€ T25-01 ~ T25-06
â””â”€â”€ é¢„è®¡ 4 å¤©

Phase 2 (ä¸‹å‘¨): å£°èª‰æ”¹è¿›
â”œâ”€â”€ T25-07 ~ T25-12
â””â”€â”€ é¢„è®¡ 5.5 å¤©

Phase 3 (åç»­): é€‰ä¸¾å¢å¼º
â””â”€â”€ å¾…è§„åˆ’
```

---

## é™„å½•: ç›¸å…³ä»£ç ä¿®æ”¹æ¸…å•

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `internal/httpapi/httpapi.go` | æ·»åŠ  Token éªŒè¯ä¸­é—´ä»¶ |
| `internal/httpapi/auth.go` | æ–°å»º: Token ç”Ÿæˆå’ŒéªŒè¯ |
| `internal/config/config.go` | æ·»åŠ  api_token é…ç½®é¡¹ |
| `cmd/node/main.go` | é¦–æ¬¡å¯åŠ¨æ‰“å° Token |
| `internal/incentive/incentive.go` | å£°èª‰æ¥æºé™åˆ¶ |
| `internal/reputation/reputation.go` | æ—¶é—´è¡°å‡ã€å¤šæ ·æ€§å› å­ |

### éœ€è¦æ–°å¢çš„æ–‡ä»¶

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `internal/httpapi/auth.go` | Token è®¤è¯é€»è¾‘ |
| `internal/httpapi/auth_test.go` | è®¤è¯æµ‹è¯• |
| `internal/reputation/decay.go` | å£°èª‰è¡°å‡è®¡ç®— |
| `internal/reputation/proof.go` | ä»»åŠ¡è¯æ˜éªŒè¯ |
